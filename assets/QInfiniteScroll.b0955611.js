import{c as D,d as k,h as w}from"./QSpinner.1f524bf5.js";import{r as b,c as C,w as f,I as O,J as U,o as V,z as _,h as T,Q as j,A as z,a7 as F,g as J}from"./index.be2a1a55.js";import{h as H}from"./dom.f50efdc0.js";import{d as v,b as S,s as I,c as R}from"./scroll.1b357255.js";const{passive:s}=j;var Y=D({name:"QInfiniteScroll",props:{offset:{type:Number,default:500},debounce:{type:[String,Number],default:100},scrollTarget:{default:void 0},initialIndex:Number,disable:Boolean,reverse:Boolean},emits:["load"],setup(l,{slots:x,emit:N}){const n=b(!1),r=b(!0),u=b(null);let c=l.initialIndex||0,e,i;const y=C(()=>"q-infinite-scroll__loading"+(n.value===!0?"":" invisible"));function o(){if(l.disable===!0||n.value===!0||r.value===!1)return;const t=v(e),a=S(e),m=H(e);l.reverse===!1?Math.round(a+m+l.offset)>=Math.round(t)&&d():Math.round(a)<=l.offset&&d()}function d(){if(l.disable===!0||n.value===!0||r.value===!1)return;c++,n.value=!0;const t=v(e);N("load",c,a=>{r.value===!0&&(n.value=!1,z(()=>{if(l.reverse===!0){const m=v(e),q=S(e),A=m-t;I(e,q+A)}a===!0?g():u.value&&u.value.closest("body")&&i()}))})}function B(){c=0}function E(){r.value===!1&&(r.value=!0,e.addEventListener("scroll",i,s)),o()}function g(){r.value===!0&&(r.value=!1,n.value=!1,e.removeEventListener("scroll",i,s),i!==void 0&&i.cancel!==void 0&&i.cancel())}function L(){if(e&&r.value===!0&&e.removeEventListener("scroll",i,s),e=R(u.value,l.scrollTarget),r.value===!0){if(e.addEventListener("scroll",i,s),l.reverse===!0){const t=v(e),a=H(e);I(e,t-a)}o()}}function M(t){c=t}function P(t){t=parseInt(t,10);const a=i;i=t<=0?o:F(o,isNaN(t)===!0?100:t),e&&r.value===!0&&(a!==void 0&&e.removeEventListener("scroll",a,s),e.addEventListener("scroll",i,s))}f(()=>l.disable,t=>{t===!0?g():E()}),f(()=>l.reverse,t=>{n.value===!1&&r.value===!0&&o()}),f(()=>l.scrollTarget,L),f(()=>l.debounce,P);let h=!1;O(()=>{h!==!1&&e&&I(e,h)}),U(()=>{h=e?S(e):!1}),V(()=>{r.value===!0&&e.removeEventListener("scroll",i,s)}),_(()=>{P(l.debounce),L()});const Q=J();return Object.assign(Q.proxy,{poll:()=>{i!==void 0&&i()},trigger:d,stop:g,reset:B,resume:E,setIndex:M}),()=>{const t=k(x.default,[]);return l.disable!==!0&&r.value===!0&&t[l.reverse===!1?"push":"unshift"](T("div",{class:y.value},w(x.loading))),T("div",{class:"q-infinite-scroll",ref:u},t)}}});export{Y as Q};
