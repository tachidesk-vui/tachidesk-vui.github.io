import{Q as E}from"./QIntersection.9257f926.js";import{Q as I}from"./QList.92904606.js";import{Q as v}from"./QInnerLoading.4daa3253.js";import{Q as b}from"./QPage.7c9c206a.js";import{i as d}from"./models.d7e94ac2.js";import{g as N,Q as z}from"./usefull.cdb53b04.js";import{Q as k,a as $}from"./QItemLabel.6b78c45a.js";import{Q as F}from"./QBtn.c26c6b21.js";import{Q as B}from"./QItem.87f955b6.js";import{Q as A}from"./QCard.50a5c9f8.js";import{storeGet as S}from"./StoreStuff.3fce3b94.js";import{d as Q,r as f,_ as U,f as r,j as c,k as a,m as n,u as C,p as y,t as u,v as h,n as x,q as L,s as V,x as w,F as _}from"./index.be2a1a55.js";import{l as j,u as G}from"./Filters.abcbd172.js";import"./Intersection.deb44cfe.js";import"./QSpinner.1f524bf5.js";import"./use-dark.3bb5a166.js";import"./use-transition.2e9d1385.js";import"./axios.74424036.js";import"./QIcon.536bbd60.js";import"./Ripple.9bc9d9e6.js";import"./dom.f50efdc0.js";const P=Q({name:"ExtCard",props:{exten:{type:Object,required:!0}},emits:["reload"],setup(){const t=f(`${S("useCache",!0)}`),e=f("");return{useCache:t,imgdata:e}},computed:{UpUnIn(){return this.exten.hasUpdate?"Update":this.exten.installed?"Uninstall":"Install"}},mounted:function(){N(this.exten.iconUrl+"?useCache="+this.useCache).then(t=>{this.imgdata=t})},methods:{capitalizeFirstLetter(t){return t.charAt(0).toUpperCase()+t.slice(1)},async HandleExt(){this.exten.hasUpdate?await this.$api.get(`/api/v1/extension/update/${this.exten.pkgName}`):this.exten.installed?await this.$api.get(`/api/v1/extension/uninstall/${this.exten.pkgName}`):await this.$api.get(`/api/v1/extension/install/${this.exten.pkgName}`),this.$emit("reload")}}}),T={class:"row content-center col-grow"},H={key:0,style:{color:"red"}},R={class:"flex items-center"};function D(t,e,i,l,m,s){return r(),c(A,{class:L(["q-ma-sm",t.$q.dark.isActive?"":"bg-light"])},{default:a(()=>[n(B,{style:{height:"100px"}},{default:a(()=>[C("div",T,[n(k,{avatar:""},{default:a(()=>[n(z,{src:t.imgdata,loading:"lazy","spinner-color":"white",style:{height:"100px","aspect-ratio":"225/225",width:"fit-content"},class:"rounded-borders items-center justify-center","no-spinner":""},{default:a(()=>[n(v,{showing:!t.imgdata,color:"primary",class:"bg-transparent"},null,8,["showing"])]),_:1},8,["src"])]),_:1}),n(k,{class:"flex-grow"},{default:a(()=>[n($,null,{default:a(()=>[y(u(t.capitalizeFirstLetter(t.exten.name)),1)]),_:1}),n($,{caption:""},{default:a(()=>[y(u(t.capitalizeFirstLetter(t.exten.lang))+" "+u(t.exten.versionName)+" ",1),t.exten.isNsfw?(r(),h("span",H,"18+")):x("",!0)]),_:1})]),_:1})]),C("div",R,[n(F,{outline:"",color:"blue",onClick:t.HandleExt},{default:a(()=>[n($,{class:L(t.$q.dark.isActive?"light":"dark")},{default:a(()=>[y(u(t.capitalizeFirstLetter(t.UpUnIn)),1)]),_:1},8,["class"])]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["class"])}var O=U(P,[["render",D]]);const J=Q({name:"SourcesPage",components:{extCard:O},emits:["set-title"],setup(t,{emit:e}){e("set-title","Extentions");const i=G(),l=i,m=f([]),s=f(i.langs);return{list:m,allLangs:[],filters:l,langs:s}},computed:{langGroups(){return this.groupExtensions(this.list)},filterList(){let t=this.langGroups;return t=t.map(e=>{let i=e[1];return this.$route.query.q&&(i=i.filter(l=>l.name.toLowerCase().includes(`${this.$route.query.q}`.toLowerCase()))),this.langs.includes(e[0])||(i=[]),[e[0],i]}),t}},created:function(){this.reload()},methods:{myTweak(t){return{height:t?`calc(100vh - ${t}px)`:"100vh"}},reload(){this.$api.get("/api/v1/extension/list").then(({data:t})=>{this.list=t})},groupExtensions(t){this.allLangs=[];const e={installed:[],"updates pending":[]};t.forEach(s=>{var p;const o=s.lang;e[o]==null&&(e[o]=[],o!=="all"&&this.allLangs.push(o)),s.installed?s.hasUpdate?d(e["updates pending"])&&e["updates pending"].push(s):d(e.installed)&&e.installed.push(s):(p=e[o])==null||p.push(s)}),this.allLangs.sort(j);const i=[["updates pending",d(e["updates pending"])?e["updates pending"]:[]],["installed",d(e.installed)?e.installed:[]],["all",d(e.all)?e.all:[]]];this.filters.setcurrlangs(this.allLangs);const l=this.allLangs.map(s=>[s,e[s]]).filter(s=>s[1]!=null);return i.concat(l)},capitalizeFirstLetter(t){return t.charAt(0).toUpperCase()+t.slice(1)}}}),K={key:0,class:"text-h4 q-ml-xl q-my-lg"};function M(t,e,i,l,m,s){const o=V("extCard");return r(),c(b,{"style-fn":t.myTweak},{default:a(()=>[(r(!0),h(_,null,w(t.filterList,p=>(r(),c(I,{key:p[0]},{default:a(()=>[p[1].length?(r(),h("div",K,u(t.capitalizeFirstLetter(p[0])),1)):x("",!0),(r(!0),h(_,null,w(p[1],(g,q)=>(r(),c(E,{key:q,style:{height:"100px",width:"100%"},class:"flex-shrink"},{default:a(()=>[!g.obsolete||g.installed?(r(),c(o,{key:0,exten:g,onReload:t.reload},null,8,["exten","onReload"])):x("",!0)]),_:2},1024))),128))]),_:2},1024))),128)),n(v,{style:{position:"fixed",left:"50%",top:"50%",transform:"translate(-50%, -50%)",width:"fit-content",height:"fit-content","background-color":"transparent"},showing:t.filterList.length==3,color:"primary"},null,8,["showing"])]),_:1},8,["style-fn"])}var $t=U(J,[["render",M]]);export{$t as default};
