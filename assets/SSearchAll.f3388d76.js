import{Q as ce}from"./QSpinnerDots.81f75520.js";import{Q as he}from"./QPage.15fd8730.js";import{u as fe}from"./Filters.e0eb5b96.js";import{m as de}from"./mangaCard.81e28b4a.js";import{_ as me,d as pe,r as $,ac as ve,f as q,j as H,k as _e,s as ye,u as A,v as M,x as J,F as K,m as we,n as X,t as ge,ab as Pe}from"./index.e607ebbf.js";import{u as be}from"./Filters.4ea6c65e.js";import{storeGet as Ee}from"./StoreStuff.8dd7626e.js";import"./QSpinner.a066f13a.js";import"./QInnerLoading.c515810d.js";import"./use-dark.5a95c9ad.js";import"./use-transition.ff15bca0.js";import"./QBadge.2e1d392f.js";import"./usefull.2dc78a7a.js";import"./axios.adfc46d0.js";import"./getenv.7492fdf7.js";import"./QCard.b23e52e7.js";import"./QIntersection.6eec15bc.js";import"./Intersection.db333c73.js";import"./Ripple.e079ce52.js";import"./dom.a3995931.js";var ae={exports:{}};(function(r){var e=Object.prototype.hasOwnProperty,t="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(t=!1));function l(o,s,a){this.fn=o,this.context=s,this.once=a||!1}function p(o,s,a,c,w){if(typeof a!="function")throw new TypeError("The listener must be a function");var y=new l(a,c||o,w),d=t?t+s:s;return o._events[d]?o._events[d].fn?o._events[d]=[o._events[d],y]:o._events[d].push(y):(o._events[d]=y,o._eventsCount++),o}function _(o,s){--o._eventsCount===0?o._events=new n:delete o._events[s]}function h(){this._events=new n,this._eventsCount=0}h.prototype.eventNames=function(){var s=[],a,c;if(this._eventsCount===0)return s;for(c in a=this._events)e.call(a,c)&&s.push(t?c.slice(1):c);return Object.getOwnPropertySymbols?s.concat(Object.getOwnPropertySymbols(a)):s},h.prototype.listeners=function(s){var a=t?t+s:s,c=this._events[a];if(!c)return[];if(c.fn)return[c.fn];for(var w=0,y=c.length,d=new Array(y);w<y;w++)d[w]=c[w].fn;return d},h.prototype.listenerCount=function(s){var a=t?t+s:s,c=this._events[a];return c?c.fn?1:c.length:0},h.prototype.emit=function(s,a,c,w,y,d){var E=t?t+s:s;if(!this._events[E])return!1;var u=this._events[E],Q=arguments.length,C,v;if(u.fn){switch(u.once&&this.removeListener(s,u.fn,void 0,!0),Q){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,a),!0;case 3:return u.fn.call(u.context,a,c),!0;case 4:return u.fn.call(u.context,a,c,w),!0;case 5:return u.fn.call(u.context,a,c,w,y),!0;case 6:return u.fn.call(u.context,a,c,w,y,d),!0}for(v=1,C=new Array(Q-1);v<Q;v++)C[v-1]=arguments[v];u.fn.apply(u.context,C)}else{var le=u.length,W;for(v=0;v<le;v++)switch(u[v].once&&this.removeListener(s,u[v].fn,void 0,!0),Q){case 1:u[v].fn.call(u[v].context);break;case 2:u[v].fn.call(u[v].context,a);break;case 3:u[v].fn.call(u[v].context,a,c);break;case 4:u[v].fn.call(u[v].context,a,c,w);break;default:if(!C)for(W=1,C=new Array(Q-1);W<Q;W++)C[W-1]=arguments[W];u[v].fn.apply(u[v].context,C)}}return!0},h.prototype.on=function(s,a,c){return p(this,s,a,c,!1)},h.prototype.once=function(s,a,c){return p(this,s,a,c,!0)},h.prototype.removeListener=function(s,a,c,w){var y=t?t+s:s;if(!this._events[y])return this;if(!a)return _(this,y),this;var d=this._events[y];if(d.fn)d.fn===a&&(!w||d.once)&&(!c||d.context===c)&&_(this,y);else{for(var E=0,u=[],Q=d.length;E<Q;E++)(d[E].fn!==a||w&&!d[E].once||c&&d[E].context!==c)&&u.push(d[E]);u.length?this._events[y]=u.length===1?u[0]:u:_(this,y)}return this},h.prototype.removeAllListeners=function(s){var a;return s?(a=t?t+s:s,this._events[a]&&_(this,a)):(this._events=new n,this._eventsCount=0),this},h.prototype.off=h.prototype.removeListener,h.prototype.addListener=h.prototype.on,h.prefixed=t,h.EventEmitter=h,r.exports=h})(ae);var Te=ae.exports;class oe extends Error{constructor(e){super(e),this.name="TimeoutError"}}class Qe extends Error{constructor(e){super(),this.name="AbortError",this.message=e}}const Z=r=>globalThis.DOMException===void 0?new Qe(r):new DOMException(r),ee=r=>{const e=r.reason===void 0?Z("This operation was aborted."):r.reason;return e instanceof Error?e:Z(e)};function Ie(r,e,t,n){let l;const p=new Promise((_,h)=>{if(typeof e!="number"||Math.sign(e)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${e}\``);if(e===Number.POSITIVE_INFINITY){_(r);return}if(n={customTimers:{setTimeout,clearTimeout},...n},n.signal){const{signal:o}=n;o.aborted&&h(ee(o)),o.addEventListener("abort",()=>{h(ee(o))})}l=n.customTimers.setTimeout.call(void 0,()=>{if(typeof t=="function"){try{_(t())}catch(a){h(a)}return}const o=typeof t=="string"?t:`Promise timed out after ${e} milliseconds`,s=t instanceof Error?t:new oe(o);typeof r.cancel=="function"&&r.cancel(),h(s)},e),(async()=>{try{_(await r)}catch(o){h(o)}finally{n.customTimers.clearTimeout.call(void 0,l)}})()});return p.clear=()=>{clearTimeout(l),l=void 0},p}function xe(r,e,t){let n=0,l=r.length;for(;l>0;){const p=Math.trunc(l/2);let _=n+p;t(r[_],e)<=0?(n=++_,l-=p+1):l=p}return n}var S=globalThis&&globalThis.__classPrivateFieldGet||function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},T;class Ce{constructor(){T.set(this,[])}enqueue(e,t){t={priority:0,...t};const n={priority:t.priority,run:e};if(this.size&&S(this,T,"f")[this.size-1].priority>=t.priority){S(this,T,"f").push(n);return}const l=xe(S(this,T,"f"),n,(p,_)=>_.priority-p.priority);S(this,T,"f").splice(l,0,n)}dequeue(){const e=S(this,T,"f").shift();return e==null?void 0:e.run}filter(e){return S(this,T,"f").filter(t=>t.priority===e.priority).map(t=>t.run)}get size(){return S(this,T,"f").length}}T=new WeakMap;var f=globalThis&&globalThis.__classPrivateFieldSet||function(r,e,t,n,l){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!l)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!l:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?l.call(r,t):l?l.value=t:e.set(r,t),t},i=globalThis&&globalThis.__classPrivateFieldGet||function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},m,k,O,x,G,z,F,b,N,g,D,P,L,I,B,te,re,ue,ie,ne,se,R,j,U,Y,V;const qe=new oe;class Se extends Error{}class $e extends Te{constructor(e){var t,n,l,p;if(super(),m.add(this),k.set(this,void 0),O.set(this,void 0),x.set(this,0),G.set(this,void 0),z.set(this,void 0),F.set(this,0),b.set(this,void 0),N.set(this,void 0),g.set(this,void 0),D.set(this,void 0),P.set(this,0),L.set(this,void 0),I.set(this,void 0),B.set(this,void 0),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e={carryoverConcurrencyCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:Ce,...e},!(typeof e.intervalCap=="number"&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(n=(t=e.intervalCap)===null||t===void 0?void 0:t.toString())!==null&&n!==void 0?n:""}\` (${typeof e.intervalCap})`);if(e.interval===void 0||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(p=(l=e.interval)===null||l===void 0?void 0:l.toString())!==null&&p!==void 0?p:""}\` (${typeof e.interval})`);f(this,k,e.carryoverConcurrencyCount,"f"),f(this,O,e.intervalCap===Number.POSITIVE_INFINITY||e.interval===0,"f"),f(this,G,e.intervalCap,"f"),f(this,z,e.interval,"f"),f(this,g,new e.queueClass,"f"),f(this,D,e.queueClass,"f"),this.concurrency=e.concurrency,this.timeout=e.timeout,f(this,B,e.throwOnTimeout===!0,"f"),f(this,I,e.autoStart===!1,"f")}get concurrency(){return i(this,L,"f")}set concurrency(e){if(!(typeof e=="number"&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);f(this,L,e,"f"),i(this,m,"m",Y).call(this)}async add(e,t={}){return new Promise((n,l)=>{const p=async()=>{var _,h,o;f(this,P,(h=i(this,P,"f"),h++,h),"f"),f(this,x,(o=i(this,x,"f"),o++,o),"f");try{if(!((_=t.signal)===null||_===void 0)&&_.aborted){l(new Se("The task was aborted."));return}const a=await(this.timeout===void 0&&t.timeout===void 0?e({signal:t.signal}):Ie(Promise.resolve(e({signal:t.signal})),t.timeout===void 0?this.timeout:t.timeout,()=>{(t.throwOnTimeout===void 0?i(this,B,"f"):t.throwOnTimeout)&&l(qe)}));n(a),this.emit("completed",a)}catch(s){l(s),this.emit("error",s)}i(this,m,"m",ue).call(this)};i(this,g,"f").enqueue(p,t),i(this,m,"m",R).call(this),this.emit("add")})}async addAll(e,t){return Promise.all(e.map(async n=>this.add(n,t)))}start(){return i(this,I,"f")?(f(this,I,!1,"f"),i(this,m,"m",Y).call(this),this):this}pause(){f(this,I,!0,"f")}clear(){f(this,g,new(i(this,D,"f")),"f")}async onEmpty(){i(this,g,"f").size!==0&&await i(this,m,"m",V).call(this,"empty")}async onSizeLessThan(e){i(this,g,"f").size<e||await i(this,m,"m",V).call(this,"next",()=>i(this,g,"f").size<e)}async onIdle(){i(this,P,"f")===0&&i(this,g,"f").size===0||await i(this,m,"m",V).call(this,"idle")}get size(){return i(this,g,"f").size}sizeBy(e){return i(this,g,"f").filter(e).length}get pending(){return i(this,P,"f")}get isPaused(){return i(this,I,"f")}}k=new WeakMap,O=new WeakMap,x=new WeakMap,G=new WeakMap,z=new WeakMap,F=new WeakMap,b=new WeakMap,N=new WeakMap,g=new WeakMap,D=new WeakMap,P=new WeakMap,L=new WeakMap,I=new WeakMap,B=new WeakMap,m=new WeakSet,te=function(){return i(this,O,"f")||i(this,x,"f")<i(this,G,"f")},re=function(){return i(this,P,"f")<i(this,L,"f")},ue=function(){var e;f(this,P,(e=i(this,P,"f"),e--,e),"f"),i(this,m,"m",R).call(this),this.emit("next")},ie=function(){this.emit("empty"),i(this,P,"f")===0&&this.emit("idle")},ne=function(){i(this,m,"m",U).call(this),i(this,m,"m",j).call(this),f(this,N,void 0,"f")},se=function(){const e=Date.now();if(i(this,b,"f")===void 0){const t=i(this,F,"f")-e;if(t<0)f(this,x,i(this,k,"f")?i(this,P,"f"):0,"f");else return i(this,N,"f")===void 0&&f(this,N,setTimeout(()=>{i(this,m,"m",ne).call(this)},t),"f"),!0}return!1},R=function(){if(i(this,g,"f").size===0)return i(this,b,"f")&&clearInterval(i(this,b,"f")),f(this,b,void 0,"f"),i(this,m,"m",ie).call(this),!1;if(!i(this,I,"f")){const e=!i(this,m,"a",se);if(i(this,m,"a",te)&&i(this,m,"a",re)){const t=i(this,g,"f").dequeue();return t?(this.emit("active"),t(),e&&i(this,m,"m",j).call(this),!0):!1}}return!1},j=function(){i(this,O,"f")||i(this,b,"f")!==void 0||(f(this,b,setInterval(()=>{i(this,m,"m",U).call(this)},i(this,z,"f")),"f"),f(this,F,Date.now()+i(this,z,"f"),"f"))},U=function(){i(this,x,"f")===0&&i(this,P,"f")===0&&i(this,b,"f")&&(clearInterval(i(this,b,"f")),f(this,b,void 0,"f")),f(this,x,i(this,k,"f")?i(this,P,"f"):0,"f"),i(this,m,"m",Y).call(this)},Y=function(){for(;i(this,m,"m",R).call(this););},V=async function(e,t){return new Promise(n=>{const l=()=>{t&&!t()||(this.off(e,l),n())};this.on(e,l)})};const We=pe({components:{mangaCard:de},setup(){const r=new $e({concurrency:5}),e=$(new AbortController),t=$([]),n=$([]),l=fe(),p=$(l.langs);return{searchResults:t,queue:r,controller:e,sources:n,langs:p,display:$(be()),devider:$(0)}},computed:{Displ(){return this.display.Display==null?"compact":this.display.Display?"comfort":"compact"},widt(){return`width: calc(100vw / ${this.devider}); aspect-ratio: 225/350;transition: width 0.5s ease-out;height: fit-content;`}},watch:{"$route.query.q"(){this.doSearch()}},created:function(){this.calcWidth=ve(this.calcWidth,500),this.$api.get("/api/v1/source/list").then(({data:r})=>{this.sources=r.filter(e=>this.langs.includes(e.lang)),this.doSearch()}),this.queue.on("completed",r=>{r!=null&&(this.searchResults=this.searchResults.concat(r).sort((e,t)=>e.mangas.length==0?1:t.mangas.length==0?-1:0))})},mounted:function(){this.calcWidth(),this.$nextTick(()=>{window.addEventListener("resize",this.calcWidth)})},beforeUnmount(){window.removeEventListener("resize",this.calcWidth)},methods:{myTweak(r){return{height:r?`calc(100vh - ${r}px)`:"100vh"}},calcWidth(){const r=this.$refs.infiniteScrol,e=Ee("MitemW",300);r.clientWidth!=null&&(this.devider=Math.round(r.clientWidth/e))},doSearch(){this.$route.query.q&&(this.queue.clear(),this.queue.pending&&(this.controller.abort(),this.controller=new AbortController),this.searchResults=[],this.sources.forEach(r=>{this.queue.add(async({signal:e})=>{if(e){const t=this.$api.get(`/api/v1/source/${r.id}/search?searchTerm=${this.$route.query.q||""}&pageNum=1`,{signal:e});try{return{source:r,mangas:(await t).data.mangaList}}catch(n){if(n instanceof DOMException)console.error(n);else return{source:r,mangas:[]}}}return{source:r,mangas:[]}},{signal:this.controller.signal})}))}}}),Ae={ref:"infiniteScrol"},Me={class:"text-h6 q-ma-md"},Ne={style:{"overflow-x":"auto"}},ke={class:"row no-wrap",style:{width:"max-content"}},Oe={key:0,class:"text-subtitle1 q-ma-md"},ze={key:0,class:"row justify-center q-my-md"};function Le(r,e,t,n,l,p){const _=ye("mangaCard");return q(),H(he,{"style-fn":r.myTweak},{default:_e(()=>[A("div",Ae,[(q(!0),M(K,null,J(r.searchResults,({source:h,mangas:o},s)=>(q(),M("div",{key:s},[A("div",null,[A("div",Me,ge(h.displayName),1),A("div",Ne,[A("div",ke,[(q(!0),M(K,null,J(o,a=>(q(),H(_,{key:a.id,style:Pe(r.widt),manga:a,display:r.Displ},null,8,["style","manga","display"]))),128)),o.length?X("",!0):(q(),M("div",Oe," No Manga "))])])])]))),128))],512),r.queue.pending?(q(),M("div",ze,[we(ce,{color:"primary",size:"40px"})])):X("",!0)]),_:1},8,["style-fn"])}var at=me(We,[["render",Le]]);export{at as default};
