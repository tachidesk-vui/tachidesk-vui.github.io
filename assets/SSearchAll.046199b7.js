import{Q as fe}from"./QScrollArea.8c24b5e9.js";import{Q as de}from"./QSpinnerDots.bda13b6a.js";import{Q as me}from"./QPage.07cecfe4.js";import{u as pe}from"./Filters.969652fa.js";import{m as ve}from"./mangaCard.0fc91bd1.js";import{_ as _e,d as ye,r as $,ac as we,f as S,j as H,k as J,s as ge,u as L,v as A,x as K,F as X,m as Z,n as ee,t as Pe,ab as be}from"./index.3fa31825.js";import{u as Ee}from"./Filters.aa677975.js";import"./use-dark.2d07ef76.js";import"./QResizeObserver.093b509b.js";import"./QSpinner.897e362a.js";import"./QScrollObserver.86f10c35.js";import"./scroll.8189b074.js";import"./dom.c6d046f6.js";import"./TouchPan.640e72a0.js";import"./selection.7aeb7461.js";import"./format.2a3572e1.js";import"./StoreStuff.d14f685c.js";import"./QInnerLoading.c76d01bb.js";import"./use-transition.10b91cda.js";import"./QBadge.91463990.js";import"./usefull.110a922e.js";import"./axios.786e56a8.js";import"./getenv.7492fdf7.js";import"./QCard.2c5e675d.js";import"./QIntersection.7d2c7e6a.js";import"./Intersection.5f7660e5.js";import"./Ripple.889195bf.js";var ue={exports:{}};(function(r){var e=Object.prototype.hasOwnProperty,t="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(t=!1));function l(o,s,a){this.fn=o,this.context=s,this.once=a||!1}function p(o,s,a,c,w){if(typeof a!="function")throw new TypeError("The listener must be a function");var y=new l(a,c||o,w),d=t?t+s:s;return o._events[d]?o._events[d].fn?o._events[d]=[o._events[d],y]:o._events[d].push(y):(o._events[d]=y,o._eventsCount++),o}function _(o,s){--o._eventsCount===0?o._events=new n:delete o._events[s]}function h(){this._events=new n,this._eventsCount=0}h.prototype.eventNames=function(){var s=[],a,c;if(this._eventsCount===0)return s;for(c in a=this._events)e.call(a,c)&&s.push(t?c.slice(1):c);return Object.getOwnPropertySymbols?s.concat(Object.getOwnPropertySymbols(a)):s},h.prototype.listeners=function(s){var a=t?t+s:s,c=this._events[a];if(!c)return[];if(c.fn)return[c.fn];for(var w=0,y=c.length,d=new Array(y);w<y;w++)d[w]=c[w].fn;return d},h.prototype.listenerCount=function(s){var a=t?t+s:s,c=this._events[a];return c?c.fn?1:c.length:0},h.prototype.emit=function(s,a,c,w,y,d){var E=t?t+s:s;if(!this._events[E])return!1;var u=this._events[E],Q=arguments.length,C,v;if(u.fn){switch(u.once&&this.removeListener(s,u.fn,void 0,!0),Q){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,a),!0;case 3:return u.fn.call(u.context,a,c),!0;case 4:return u.fn.call(u.context,a,c,w),!0;case 5:return u.fn.call(u.context,a,c,w,y),!0;case 6:return u.fn.call(u.context,a,c,w,y,d),!0}for(v=1,C=new Array(Q-1);v<Q;v++)C[v-1]=arguments[v];u.fn.apply(u.context,C)}else{var he=u.length,W;for(v=0;v<he;v++)switch(u[v].once&&this.removeListener(s,u[v].fn,void 0,!0),Q){case 1:u[v].fn.call(u[v].context);break;case 2:u[v].fn.call(u[v].context,a);break;case 3:u[v].fn.call(u[v].context,a,c);break;case 4:u[v].fn.call(u[v].context,a,c,w);break;default:if(!C)for(W=1,C=new Array(Q-1);W<Q;W++)C[W-1]=arguments[W];u[v].fn.apply(u[v].context,C)}}return!0},h.prototype.on=function(s,a,c){return p(this,s,a,c,!1)},h.prototype.once=function(s,a,c){return p(this,s,a,c,!0)},h.prototype.removeListener=function(s,a,c,w){var y=t?t+s:s;if(!this._events[y])return this;if(!a)return _(this,y),this;var d=this._events[y];if(d.fn)d.fn===a&&(!w||d.once)&&(!c||d.context===c)&&_(this,y);else{for(var E=0,u=[],Q=d.length;E<Q;E++)(d[E].fn!==a||w&&!d[E].once||c&&d[E].context!==c)&&u.push(d[E]);u.length?this._events[y]=u.length===1?u[0]:u:_(this,y)}return this},h.prototype.removeAllListeners=function(s){var a;return s?(a=t?t+s:s,this._events[a]&&_(this,a)):(this._events=new n,this._eventsCount=0),this},h.prototype.off=h.prototype.removeListener,h.prototype.addListener=h.prototype.on,h.prefixed=t,h.EventEmitter=h,r.exports=h})(ue);var Te=ue.exports;class le extends Error{constructor(e){super(e),this.name="TimeoutError"}}class Qe extends Error{constructor(e){super(),this.name="AbortError",this.message=e}}const te=r=>globalThis.DOMException===void 0?new Qe(r):new DOMException(r),re=r=>{const e=r.reason===void 0?te("This operation was aborted."):r.reason;return e instanceof Error?e:te(e)};function Ie(r,e,t,n){let l;const p=new Promise((_,h)=>{if(typeof e!="number"||Math.sign(e)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${e}\``);if(e===Number.POSITIVE_INFINITY){_(r);return}if(n={customTimers:{setTimeout,clearTimeout},...n},n.signal){const{signal:o}=n;o.aborted&&h(re(o)),o.addEventListener("abort",()=>{h(re(o))})}l=n.customTimers.setTimeout.call(void 0,()=>{if(typeof t=="function"){try{_(t())}catch(a){h(a)}return}const o=typeof t=="string"?t:`Promise timed out after ${e} milliseconds`,s=t instanceof Error?t:new le(o);typeof r.cancel=="function"&&r.cancel(),h(s)},e),(async()=>{try{_(await r)}catch(o){h(o)}finally{n.customTimers.clearTimeout.call(void 0,l)}})()});return p.clear=()=>{clearTimeout(l),l=void 0},p}function xe(r,e,t){let n=0,l=r.length;for(;l>0;){const p=Math.trunc(l/2);let _=n+p;t(r[_],e)<=0?(n=++_,l-=p+1):l=p}return n}var q=globalThis&&globalThis.__classPrivateFieldGet||function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},T;class Ce{constructor(){T.set(this,[])}enqueue(e,t){t={priority:0,...t};const n={priority:t.priority,run:e};if(this.size&&q(this,T,"f")[this.size-1].priority>=t.priority){q(this,T,"f").push(n);return}const l=xe(q(this,T,"f"),n,(p,_)=>_.priority-p.priority);q(this,T,"f").splice(l,0,n)}dequeue(){const e=q(this,T,"f").shift();return e==null?void 0:e.run}filter(e){return q(this,T,"f").filter(t=>t.priority===e.priority).map(t=>t.run)}get size(){return q(this,T,"f").length}}T=new WeakMap;var f=globalThis&&globalThis.__classPrivateFieldSet||function(r,e,t,n,l){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!l)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!l:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?l.call(r,t):l?l.value=t:e.set(r,t),t},i=globalThis&&globalThis.__classPrivateFieldGet||function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},m,N,k,x,G,O,F,b,M,g,D,P,z,I,B,ie,ne,ce,se,ae,oe,R,j,U,Y,V;const Se=new le;class qe extends Error{}class $e extends Te{constructor(e){var t,n,l,p;if(super(),m.add(this),N.set(this,void 0),k.set(this,void 0),x.set(this,0),G.set(this,void 0),O.set(this,void 0),F.set(this,0),b.set(this,void 0),M.set(this,void 0),g.set(this,void 0),D.set(this,void 0),P.set(this,0),z.set(this,void 0),I.set(this,void 0),B.set(this,void 0),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e={carryoverConcurrencyCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:Ce,...e},!(typeof e.intervalCap=="number"&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(n=(t=e.intervalCap)===null||t===void 0?void 0:t.toString())!==null&&n!==void 0?n:""}\` (${typeof e.intervalCap})`);if(e.interval===void 0||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(p=(l=e.interval)===null||l===void 0?void 0:l.toString())!==null&&p!==void 0?p:""}\` (${typeof e.interval})`);f(this,N,e.carryoverConcurrencyCount,"f"),f(this,k,e.intervalCap===Number.POSITIVE_INFINITY||e.interval===0,"f"),f(this,G,e.intervalCap,"f"),f(this,O,e.interval,"f"),f(this,g,new e.queueClass,"f"),f(this,D,e.queueClass,"f"),this.concurrency=e.concurrency,this.timeout=e.timeout,f(this,B,e.throwOnTimeout===!0,"f"),f(this,I,e.autoStart===!1,"f")}get concurrency(){return i(this,z,"f")}set concurrency(e){if(!(typeof e=="number"&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);f(this,z,e,"f"),i(this,m,"m",Y).call(this)}async add(e,t={}){return new Promise((n,l)=>{const p=async()=>{var _,h,o;f(this,P,(h=i(this,P,"f"),h++,h),"f"),f(this,x,(o=i(this,x,"f"),o++,o),"f");try{if(!((_=t.signal)===null||_===void 0)&&_.aborted){l(new qe("The task was aborted."));return}const a=await(this.timeout===void 0&&t.timeout===void 0?e({signal:t.signal}):Ie(Promise.resolve(e({signal:t.signal})),t.timeout===void 0?this.timeout:t.timeout,()=>{(t.throwOnTimeout===void 0?i(this,B,"f"):t.throwOnTimeout)&&l(Se)}));n(a),this.emit("completed",a)}catch(s){l(s),this.emit("error",s)}i(this,m,"m",ce).call(this)};i(this,g,"f").enqueue(p,t),i(this,m,"m",R).call(this),this.emit("add")})}async addAll(e,t){return Promise.all(e.map(async n=>this.add(n,t)))}start(){return i(this,I,"f")?(f(this,I,!1,"f"),i(this,m,"m",Y).call(this),this):this}pause(){f(this,I,!0,"f")}clear(){f(this,g,new(i(this,D,"f")),"f")}async onEmpty(){i(this,g,"f").size!==0&&await i(this,m,"m",V).call(this,"empty")}async onSizeLessThan(e){i(this,g,"f").size<e||await i(this,m,"m",V).call(this,"next",()=>i(this,g,"f").size<e)}async onIdle(){i(this,P,"f")===0&&i(this,g,"f").size===0||await i(this,m,"m",V).call(this,"idle")}get size(){return i(this,g,"f").size}sizeBy(e){return i(this,g,"f").filter(e).length}get pending(){return i(this,P,"f")}get isPaused(){return i(this,I,"f")}}N=new WeakMap,k=new WeakMap,x=new WeakMap,G=new WeakMap,O=new WeakMap,F=new WeakMap,b=new WeakMap,M=new WeakMap,g=new WeakMap,D=new WeakMap,P=new WeakMap,z=new WeakMap,I=new WeakMap,B=new WeakMap,m=new WeakSet,ie=function(){return i(this,k,"f")||i(this,x,"f")<i(this,G,"f")},ne=function(){return i(this,P,"f")<i(this,z,"f")},ce=function(){var e;f(this,P,(e=i(this,P,"f"),e--,e),"f"),i(this,m,"m",R).call(this),this.emit("next")},se=function(){this.emit("empty"),i(this,P,"f")===0&&this.emit("idle")},ae=function(){i(this,m,"m",U).call(this),i(this,m,"m",j).call(this),f(this,M,void 0,"f")},oe=function(){const e=Date.now();if(i(this,b,"f")===void 0){const t=i(this,F,"f")-e;if(t<0)f(this,x,i(this,N,"f")?i(this,P,"f"):0,"f");else return i(this,M,"f")===void 0&&f(this,M,setTimeout(()=>{i(this,m,"m",ae).call(this)},t),"f"),!0}return!1},R=function(){if(i(this,g,"f").size===0)return i(this,b,"f")&&clearInterval(i(this,b,"f")),f(this,b,void 0,"f"),i(this,m,"m",se).call(this),!1;if(!i(this,I,"f")){const e=!i(this,m,"a",oe);if(i(this,m,"a",ie)&&i(this,m,"a",ne)){const t=i(this,g,"f").dequeue();return t?(this.emit("active"),t(),e&&i(this,m,"m",j).call(this),!0):!1}}return!1},j=function(){i(this,k,"f")||i(this,b,"f")!==void 0||(f(this,b,setInterval(()=>{i(this,m,"m",U).call(this)},i(this,O,"f")),"f"),f(this,F,Date.now()+i(this,O,"f"),"f"))},U=function(){i(this,x,"f")===0&&i(this,P,"f")===0&&i(this,b,"f")&&(clearInterval(i(this,b,"f")),f(this,b,void 0,"f")),f(this,x,i(this,N,"f")?i(this,P,"f"):0,"f"),i(this,m,"m",Y).call(this)},Y=function(){for(;i(this,m,"m",R).call(this););},V=async function(e,t){return new Promise(n=>{const l=()=>{t&&!t()||(this.off(e,l),n())};this.on(e,l)})};const We=ye({components:{mangaCard:ve},setup(){const r=new $e({concurrency:5}),e=$(new AbortController),t=$([]),n=$([]),l=pe(),p=$(l.langs);return{searchResults:t,queue:r,controller:e,sources:n,langs:p,display:$(Ee()),devider:$(0)}},computed:{Displ(){return this.display.Display==null?"compact":this.display.Display?"comfort":"compact"},widt(){return`width: calc(100vw / ${this.devider}); aspect-ratio: 225/350;transition: width 0.5s ease-out;height: fit-content;`}},watch:{"$route.query.q"(){this.doSearch()}},created:function(){this.calcWidth=we(this.calcWidth,500),this.$api.get("/api/v1/source/list").then(({data:r})=>{this.sources=r.filter(e=>this.langs.includes(e.lang)),this.doSearch()}),this.queue.on("completed",r=>{r!=null&&(this.searchResults=this.searchResults.concat(r).sort((e,t)=>e.mangas.length==0?1:t.mangas.length==0?-1:0))})},mounted:function(){this.calcWidth(),this.$nextTick(()=>{window.addEventListener("resize",this.calcWidth)})},beforeUnmount(){window.removeEventListener("resize",this.calcWidth)},methods:{myTweak(r){return{height:r?`calc(100vh - ${r}px)`:"100vh"}},calcWidth(){const r=this.$refs.infiniteScrol,e=this.$q.localStorage.getItem("MitemW");r.clientWidth!=null&&(this.devider=Math.round(r.clientWidth/e))},doSearch(){this.$route.query.q&&(this.queue.clear(),this.queue.pending&&(this.controller.abort(),this.controller=new AbortController),this.searchResults=[],this.sources.forEach(r=>{this.queue.add(async({signal:e})=>{if(e){const t=this.$api.get(`/api/v1/source/${r.id}/search?searchTerm=${this.$route.query.q||""}&pageNum=1`,{signal:e});try{return{source:r,mangas:(await t).data.mangaList}}catch(n){if(n instanceof DOMException)console.error(n);else return{source:r,mangas:[]}}}return{source:r,mangas:[]}},{signal:this.controller.signal})}))}}}),Ae={ref:"infiniteScrol"},Me={class:"text-h6 q-ma-md"},Ne={class:"row no-wrap"},ke={key:0,class:"text-subtitle1 q-ma-md"},Oe={key:0,class:"row justify-center q-my-md"};function ze(r,e,t,n,l,p){const _=ge("mangaCard");return S(),H(me,{"style-fn":r.myTweak},{default:J(()=>[L("div",Ae,[(S(!0),A(X,null,K(r.searchResults,({source:h,mangas:o},s)=>(S(),A("div",{key:s},[L("div",null,[L("div",Me,Pe(h.displayName),1),Z(fe,{style:{height:"331.84px",width:"100%"}},{default:J(()=>[L("div",Ne,[(S(!0),A(X,null,K(o,a=>(S(),H(_,{key:a.id,style:be(r.widt),manga:a,display:r.Displ},null,8,["style","manga","display"]))),128)),o.length?ee("",!0):(S(),A("div",ke," No Manga "))])]),_:2},1024)])]))),128))],512),r.queue.pending?(S(),A("div",Oe,[Z(de,{color:"primary",size:"40px"})])):ee("",!0)]),_:1},8,["style-fn"])}var ft=_e(We,[["render",ze]]);export{ft as default};
