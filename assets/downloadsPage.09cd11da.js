import{Q as P}from"./QIcon.536bbd60.js";import{Q as g,a as i}from"./QItemLabel.6b78c45a.js";import{Q as O}from"./QLinearProgress.f76eef9c.js";import{Q as q}from"./QBtn.c26c6b21.js";import{Q as $}from"./QItem.87f955b6.js";import{Q as j}from"./QList.92904606.js";import{u as H,a as J}from"./use-dark.3bb5a166.js";import{c as L,h as G,a as W}from"./QSpinner.1f524bf5.js";import{c as v,h as p,g as K,r as h,w as B,an as X,z as Y,I as Z,J as ee,o as te,Q as I,_ as ae,d as le,f as m,j as k,k as a,v as D,n as y,B as Q,m as t,p as E,t as _,u as s,ai as oe}from"./index.be2a1a55.js";import{u as re,a as se}from"./use-virtual-scroll.89f53c72.js";import{c as ie}from"./scroll.1b357255.js";import{Q as ne}from"./QCardSection.abb98ff7.js";import{Q as de}from"./QCardActions.68b479f0.js";import{Q as ue}from"./QCard.50a5c9f8.js";import{Q as ce}from"./QDialog.916163c2.js";import{Q as fe}from"./QPage.7c9c206a.js";import{R as me}from"./Ripple.9bc9d9e6.js";import{C as F}from"./ClosePopup.4c2b8e09.js";import{u as ve}from"./useDlSock.af7b7fa8.js";import{p as z}from"./models.d7e94ac2.js";import{u as he}from"./use-quasar.c5e4fa53.js";import{storeGet as pe}from"./StoreStuff.3fce3b94.js";import"./rtl.b51694b1.js";import"./dom.f50efdc0.js";import"./use-timeout.4f668f64.js";import"./use-transition.2e9d1385.js";import"./focus-manager.32f8d49a.js";const ge=["horizontal","vertical","cell","none"];var _e=L({name:"QMarkupTable",props:{...H,dense:Boolean,flat:Boolean,bordered:Boolean,square:Boolean,wrapCells:Boolean,separator:{type:String,default:"horizontal",validator:e=>ge.includes(e)}},setup(e,{slots:l}){const d=K(),r=J(e,d.proxy.$q),n=v(()=>`q-markup-table q-table__container q-table__card q-table--${e.separator}-separator`+(r.value===!0?" q-table--dark q-table__card--dark q-dark":"")+(e.dense===!0?" q-table--dense":"")+(e.flat===!0?" q-table--flat":"")+(e.bordered===!0?" q-table--bordered":"")+(e.square===!0?" q-table--square":"")+(e.wrapCells===!1?" q-table--no-wrap":""));return()=>p("div",{class:n.value},[p("table",{class:"q-table"},G(l.default))])}});function be(e,l){return p("div",e,[p("table",{class:"q-table"},l)])}const we={list:j,table:_e},Se=["list","table","__qtable"];var qe=L({name:"QVirtualScroll",props:{...re,type:{type:String,default:"list",validator:e=>Se.includes(e)},items:{type:Array,default:()=>[]},itemsFn:Function,itemsSize:Number,scrollTarget:{default:void 0}},setup(e,{slots:l,attrs:d}){let r;const n=h(null),u=v(()=>e.itemsSize>=0&&e.itemsFn!==void 0?parseInt(e.itemsSize,10):Array.isArray(e.items)?e.items.length:0),{virtualScrollSliceRange:o,localResetVirtualScroll:c,padVirtualScroll:b,onVirtualScrollEvt:x}=se({virtualScrollLength:u,getVirtualScrollTarget:R,getVirtualScrollEl:T}),M=v(()=>{if(u.value===0)return[];const f=(U,A)=>({index:o.value.from+A,item:U});return e.itemsFn===void 0?e.items.slice(o.value.from,o.value.to).map(f):e.itemsFn(o.value.from,o.value.to-o.value.from).map(f)}),C=v(()=>"q-virtual-scroll q-virtual-scroll"+(e.virtualScrollHorizontal===!0?"--horizontal":"--vertical")+(e.scrollTarget!==void 0?"":" scroll")),N=v(()=>e.scrollTarget!==void 0?{}:{tabindex:0});B(u,()=>{c()}),B(()=>e.scrollTarget,()=>{S(),w()});function T(){return n.value.$el||n.value}function R(){return r}function w(){r=ie(T(),e.scrollTarget),r.addEventListener("scroll",x,I.passive)}function S(){r!==void 0&&(r.removeEventListener("scroll",x,I.passive),r=void 0)}function V(){let f=b(e.type==="list"?"div":"tbody",M.value.map(l.default));return l.before!==void 0&&(f=l.before().concat(f)),W(l.after,f)}return X(()=>{c()}),Y(()=>{w()}),Z(()=>{w()}),ee(()=>{S()}),te(()=>{S()}),()=>{if(l.default===void 0){console.error("QVirtualScroll: default scoped slot is required for rendering");return}return e.type==="__qtable"?be({ref:n,class:"q-table__middle "+C.value},V()):p(we[e.type],{...d,ref:n,class:[d.class,C.value],...N.value},V)}}});const ke=le({emits:["set-title"],setup(e,{emit:l}){l("set-title","Downloads");const d=he(),r=ve(),n=h(r),u=pe("baseUrl",location.origin),o=h([]),c=r.eventsFromServer.value?JSON.parse(r.eventsFromServer.value):[];z(c)&&(o.value=c.queue),n.value.isConnected&&r.sendMsg("STATUS");const b=h(new URL(u).origin!=location.origin&&!d.localStorage.getItem("dontshowagainWH")&&!!d.localStorage.getItem("auth"));return{downloads:o,goodBase:b,Emitter:n,filtering:h([])}},computed:{downlfilt(){return this.filtering.length?this.downloads.filter(e=>this.filtering.includes(e.state)):this.downloads}},watch:{"Emitter.eventsFromServer"(e){const l=JSON.parse(e);z(l)&&(this.downloads=l.queue)}},created(){this.$bus.on("DLFilter",e=>{this.filtering=e})},methods:{myTweak(e){return{height:e?`calc(100vh - ${e}px)`:"100vh"}},async delet(e){this.$api.delete(`/api/v1/download/${e.mangaId}/chapter/${e.chapterIndex}`),this.$api.delete(`/api/v1/manga/${e.mangaId}/chapter/${e.chapterIndex}`,{method:"DELETE"})},dontshowagain(){this.$q.localStorage.set("dontshowagainWH",!0)}}}),ye={key:0},Qe={key:1},xe={class:"col-6"},Ce=s("div",null," 1. Move this UI to the same origin as the server (Recomended) ",-1),Te=s("div",null,"replace the default webui files with this ones files",-1),Ve=s("div",null,"or some reverse proxy jank",-1),$e=s("div",null,"2. dissable authentication on the webhook url",-1),Be=s("div",null,"/api/v1/downloads",-1),Ie=s("div",null,"with some reverse proxy jank",-1),De=s("div",null,"3. dissable authentication",-1),Ee=s("div",null,"in server configs",-1),Fe=s("div",null,"4. Go to the default webUI and login",-1),ze=s("div",null,"per browser",-1),Le=s("div",null," this is a temporary fix as it will clear after a month (i think) ",-1);function Me(e,l,d,r,n,u){return m(),k(fe,{class:"flex items-center justify-center","style-fn":e.myTweak},{default:a(()=>[!e.downloads.length&&e.Emitter.isConnected?(m(),D("div",ye,"No Downloads")):y("",!0),!e.downlfilt.length&&e.downloads.length&&e.Emitter.isConnected?(m(),D("div",Qe," No Downloads fit filter ")):y("",!0),e.downlfilt.length?(m(),k(qe,{key:2,items:e.downlfilt,class:"self-start",style:{flex:"auto",height:"100%"}},{default:a(({item:o})=>[Q((m(),k($,{clickable:"",class:"q-pa-lg"},{default:a(()=>[t(g,{avatar:""},{default:a(()=>[t(P,{name:"drag_handle",size:"sm"})]),_:1}),t(g,null,{default:a(()=>[t(i,{class:"text-weight-medium text-h6"},{default:a(()=>[E(_(o.manga.title),1)]),_:2},1024),t(i,{caption:"",class:""},{default:a(()=>[s("div",xe," Chapter "+_(o.chapterIndex)+" ("+_((o.progress*100).toFixed(2))+"%) => state: "+_(o.state),1),t(O,{value:o.progress,style:{width:"100%","max-width":"500px"}},null,8,["value"])]),_:2},1024)]),_:2},1024),t(g,{avatar:""},{default:a(()=>[t(q,{round:"",flat:"",icon:"delete",class:"flex-right",onClick:[l[0]||(l[0]=oe(()=>{},["prevent"])),c=>e.delet(o)]},null,8,["onClick"])]),_:2},1024)]),_:2},1024)),[[me]])]),_:1},8,["items"])):y("",!0),t(ce,{modelValue:e.goodBase,"onUpdate:modelValue":l[1]||(l[1]=o=>e.goodBase=o),persistent:""},{default:a(()=>[t(ue,{style:{"min-width":"350px"}},{default:a(()=>[t(ne,{class:""},{default:a(()=>[t($,null,{default:a(()=>[t(g,null,{default:a(()=>[t(i,{class:"text-h6 text-negative"},{default:a(()=>[E(" Downloads webhook may not work with authentication. ")]),_:1}),t(i,{class:"text-info q-pt-lg"},{default:a(()=>[Ce]),_:1}),t(i,{caption:"",class:"text-info"},{default:a(()=>[Te,Ve]),_:1}),t(i,{class:"text-info q-pt-lg"},{default:a(()=>[$e]),_:1}),t(i,{caption:"",class:"text-info"},{default:a(()=>[Be,Ie]),_:1}),t(i,{class:"text-info q-pt-lg"},{default:a(()=>[De]),_:1}),t(i,{caption:"",class:"text-info"},{default:a(()=>[Ee]),_:1}),t(i,{class:"text-info q-pt-lg"},{default:a(()=>[Fe]),_:1}),t(i,{caption:"",class:"text-info"},{default:a(()=>[ze,Le]),_:1})]),_:1})]),_:1})]),_:1}),t(de,{align:"right",class:"text-primary"},{default:a(()=>[Q(t(q,{flat:"",label:"Ok"},null,512),[[F]]),Q(t(q,{flat:"",label:"Dont show again",onClick:e.dontshowagain},null,8,["onClick"]),[[F]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["style-fn"])}var ft=ae(ke,[["render",Me]]);export{ft as default};
