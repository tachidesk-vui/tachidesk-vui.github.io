import{Q as P,a as Q}from"./QItemLabel.c44d9f45.js";import{Q as R}from"./QItem.bc55f9b3.js";import{Q as B}from"./QCardSection.3cc22be1.js";import{u as F,a as V,Q as G}from"./QBtn.d09c3270.js";import{Q as W}from"./QCardActions.c3a39097.js";import{Q as D}from"./QCard.0a761dda.js";import{Q as j}from"./QDialog.2d22470a.js";import{Q as z}from"./QPage.f024ecae.js";import{C as S}from"./ClosePopup.a227b8fc.js";import{u as A,a as H,b as N,Q as E}from"./QTabs.2f0410c3.js";import{c as O}from"./QSpinner.5eed4aaf.js";import{c as U,w as x,d as C,r as u,_ as k,a4 as J,a5 as K,f as r,v as f,u as m,m as i,k as s,F as _,x as I,q as h,j as l,s as v,B as M,a6 as c,p as b,t as p,n as d,a7 as X}from"./index.0e613efa.js";import{Q as Y}from"./QIntersection.3c694c62.js";import{Q as q}from"./QInnerLoading.d2177515.js";import{Q as $}from"./QBadge.94b81c18.js";import{g as Z,Q as T}from"./usefull.376ae9d0.js";import{R as tt}from"./Ripple.3ab13508.js";import{storeGet as et}from"./StoreStuff.21e2f4bb.js";import{u as at}from"./Filters.f69cd8c4.js";import"./use-dark.6a672a10.js";import"./QIcon.5f4d6aeb.js";import"./use-timeout.8d87aef2.js";import"./scroll.924aa4d3.js";import"./dom.41615696.js";import"./use-transition.5dfc4757.js";import"./focus-manager.32f8d49a.js";import"./uid.42677368.js";import"./QResizeObserver.a705a8d4.js";import"./rtl.b51694b1.js";import"./Intersection.aca7a5d8.js";import"./axios.3ffc132c.js";import"./getenv.7492fdf7.js";var st=O({name:"QRouteTab",props:{...F,...A},emits:H,setup(t,{slots:e,emit:a}){const o=V({useDisableForRouterLinkProps:!1}),{renderTab:g,$tabs:y}=N(t,e,a,{exact:U(()=>t.exact),...o});return x(()=>`${t.name} | ${t.exact} | ${(o.resolvedLink.value||{}).href}`,()=>{y.verifyRouteModel()}),()=>g(o.linkTag.value,o.linkAttrs.value)}});const rt=C({name:"TabPanel",props:{tabs:{type:Array,default:()=>[]}},setup(){const t=J(),e=K();return e.query.tab===void 0&&t.push({query:{...e.query,tab:0}}),{tab:u(new Number(e.query.tab).valueOf()||0)}}}),it={class:""},nt={class:"q-gutter-y-md"};function ot(t,e,a,o,g,y){return r(),f("div",it,[m("div",nt,[i(E,{modelValue:t.tab,"onUpdate:modelValue":e[0]||(e[0]=n=>t.tab=n),"inline-label":"",class:h(t.$q.dark.isActive?"bg-dark-page":"bg-light-page")},{default:s(()=>[(r(!0),f(_,null,I(t.tabs,n=>(r(),l(st,{key:n.tabID,name:n.tabID,label:n.tabname,class:h(["col-grow",t.$route.query.tab==n.tabID.toString()?"text-primary":""]),flat:"",to:{query:{...t.$route.query,tab:n.tabID}}},null,8,["name","label","to","class"]))),128))]),_:1},8,["modelValue","class"])])])}var lt=k(rt,[["render",ot]]);const dt=C({name:"MangaCard",props:{manga:{type:Object,default:()=>Object},display:{type:String,default:"compact"}},setup(){const t=u(`${et("useCache",!0)}`),e=u("");return{useCache:t,imgdata:e}},computed:{listdivClass(){return this.display=="list"?"text-left q-ml-md text-h5 col-shrink":"text-center text-subtitle1"}},mounted:function(){Z(this.manga.thumbnailUrl+"?useCache="+this.useCache).then(t=>{this.imgdata=t})}}),ut={class:"transparent absolute-top q-mt-xs q-ml-xs",style:{padding:"0"}},mt=["title"],ct={class:"row items-center col-grow no-wrap"},pt=["title"];function ht(t,e,a,o,g,y){const n=v("router-link");return M((r(),l(D,{flat:"",class:h(["my-card",t.$q.screen.sm||t.$q.screen.xs?"q-ma-xs":"q-ma-sm"]),style:c(t.display=="list"?"":"background: transparent")},{default:s(()=>[i(n,{to:"/manga/"+t.manga.id,class:h(["cursor-pointer",t.$q.dark.isActive?"light":"dark"]),style:{"text-decoration":"none"}},{default:s(()=>[t.display!="list"?(r(),l(T,{key:0,src:t.imgdata,loading:"lazy","spinner-color":"white",style:{"max-width":"100%","aspect-ratio":"225/350"},class:"rounded-borders","no-spinner":""},{default:s(()=>[i(q,{showing:!t.imgdata,color:"primary"},null,8,["showing"]),m("div",ut,[t.manga.unreadCount?(r(),l($,{key:0,color:"blue",style:c([{width:"min-content",padding:"5px"},t.manga.downloadCount?"border-top-right-radius: 0;border-bottom-right-radius: 0;":""])},{default:s(()=>[b(p(t.manga.unreadCount),1)]),_:1},8,["style"])):d("",!0),t.manga.downloadCount?(r(),l($,{key:1,color:"green",style:c([{width:"min-content",padding:"5px"},t.manga.unreadCount?"border-top-left-radius: 0;border-bottom-left-radius: 0;":""])},{default:s(()=>[b(p(t.manga.downloadCount),1)]),_:1},8,["style"])):d("",!0)]),t.display=="compact"?(r(),f("div",{key:0,class:"absolute-bottom text-subtitle1 text-center",title:t.manga.title,style:{padding:"0",display:"-webkit-box","-webkit-line-clamp":"2","-webkit-box-orient":"vertical","text-overflow":"ellipsis",height:"3.5rem"}},p(t.manga.title),9,mt)):d("",!0)]),_:1},8,["src"])):d("",!0),m("div",ct,[t.display=="list"?(r(),l(T,{key:0,src:t.imgdata,loading:"lazy","spinner-color":"white",style:{height:"93px","aspect-ratio":"225/350",width:"fit-content"},class:"rounded-borders items-center justify-center col-1","no-spinner":""},{default:s(()=>[i(q,{showing:!t.imgdata,color:"primary"},null,8,["showing"])]),_:1},8,["src"])):d("",!0),t.display!="compact"?(r(),f("div",{key:1,class:h(t.listdivClass),title:t.manga.title,style:c([{padding:"0",display:"-webkit-box","-webkit-line-clamp":"3","-webkit-box-orient":"vertical","text-overflow":"ellipsis",overflow:"hidden",width:"100%"},t.display=="list"?"":"height: 5.25rem;"])},p(t.manga.title),15,pt)):d("",!0),m("div",{class:h(["justify-end flex items-end col-grow",t.$q.screen.sm||t.$q.screen.xs?"q-mr-xs":"q-mr-lg"])},[t.manga.unreadCount&&t.display=="list"?(r(),l($,{key:0,color:"blue",style:c([{width:"min-content",padding:"5px"},t.manga.downloadCount?"border-top-right-radius: 0;border-bottom-right-radius: 0;":""])},{default:s(()=>[b(p(t.manga.unreadCount),1)]),_:1},8,["style"])):d("",!0),t.manga.downloadCount&&t.display=="list"?(r(),l($,{key:1,color:"green",style:c([{width:"min-content",padding:"5px"},t.manga.unreadCount?"border-top-left-radius: 0;border-bottom-left-radius: 0;":""])},{default:s(()=>[b(p(t.manga.downloadCount),1)]),_:1},8,["style"])):d("",!0)],2)])]),_:1},8,["to","class"])]),_:1},8,["class","style"])),[[tt]])}var ft=k(dt,[["render",ht],["__scopeId","data-v-41e8beda"]]);const gt=C({name:"MangaGrid",components:{MangaCard:ft},setup(){const t=u(at()),e=u(0),a=u(0),o=u([]);return{devider:e,mangas:o,filters:t,clwidth:a}},computed:{doFilt(){let t=this.mangas;return this.$route.query.q&&(t=t.filter(e=>e.title.toLowerCase().includes(`${this.$route.query.q||""}`.toLowerCase()))),this.filters.unread!=null&&(t=t.filter(e=>this.filters.unread?!!e.unreadCount:!e.unreadCount)),this.filters.downloaded!=null&&(t=t.filter(e=>this.filters.downloaded?!!e.downloadCount:!e.downloadCount)),t},dosrt(){let t=this.doFilt;return this.filters.leftToRead!=null&&(t=t.sort((e,a)=>this.filters.leftToRead?e.unreadCount>=a.unreadCount?-1:1:e.unreadCount<=a.unreadCount?-1:1)),this.filters.alphabetical!=null&&(t=t.sort((e,a)=>this.filters.alphabetical?e.title>=a.title?-1:1:e.title<=a.title?-1:1)),this.filters.ByID!=null&&(t=t.sort((e,a)=>this.filters.ByID?e.id>=a.id?-1:1:e.id<=a.id?-1:1)),t},Displ(){return this.filters.Display==null?"compact":this.filters.Display?"comfort":"list"},widt(){return this.Displ=="list"?"width:100%; height: 109px;":`width: calc(100% / ${this.devider}); aspect-ratio: 225/350;transition: width 0.5s ease-out;`}},watch:{"$route.query.tab":async function(t){this.reload(t)}},created:async function(){this.calcWidth=X(this.calcWidth,500),this.reload(this.$route.query.tab)},mounted:function(){this.calcWidth(),this.$nextTick(()=>{window.addEventListener("resize",this.calcWidth)})},beforeUnmount(){window.removeEventListener("resize",this.calcWidth)},methods:{calcWidth(){const t=this.$refs.MangaGrid,e=this.$storeGet("MitemW",300);t.clientWidth!=null&&(this.devider=Math.round(t.clientWidth/e))},calcHeight(){var e;const t=(e=this.$parent)==null?void 0:e.$el;if(t){let a=t.clientHeight;return a-=t.children[0].clientHeight,a}return 0},async reload(t){t!=null&&(this.mangas=[],this.mangas=(await this.$api.get(`/api/v1/category/${this.$route.query.tab}`)).data)}}}),yt={ref:"MangaGrid",class:"flex"};function bt(t,e,a,o,g,y){const n=v("MangaCard");return r(),f(_,null,[m("div",yt,[(r(!0),f(_,null,I(t.dosrt,w=>(r(),l(Y,{key:w.id,style:c(t.widt),transition:"fade"},{default:s(()=>[i(n,{display:t.Displ,manga:w},null,8,["display","manga"])]),_:2},1032,["style"]))),128))],512),i(q,{style:{position:"fixed",left:"50%",top:"50%",transform:"translate(-50%, -50%)",width:"fit-content",height:"fit-content","background-color":"transparent"},showing:!t.dosrt.length,color:"primary"},null,8,["showing"])],64)}var wt=k(gt,[["render",bt]]);const $t=C({name:"LibraryPage",components:{TabPanel:lt,MangaGrid:wt},emits:["set-title"],setup(t,{emit:e}){e("set-title","Library");const a=u([]),o=u(!1);return{tabs:a,failedFetch:o}},created:async function(){try{const t=await this.$api.get("/api/v1/category");this.tabs=t.data.map(e=>({tabname:e.name,tabID:e.id}))}catch{this.failedFetch=!0}},methods:{myTweak(t){return{height:t?`calc(100vh - ${t}px)`:"100vh"}}}}),vt=m("div",null,"Have you set your server address?",-1),Ct=m("div",null,"Is the server running?",-1),kt=m("div",{class:"q-pt-sm"}," Pressing Ok will take you to the settings page ",-1);function _t(t,e,a,o,g,y){const n=v("TabPanel"),w=v("MangaGrid");return r(),l(z,{"style-fn":t.myTweak},{default:s(()=>[i(n,{active:"",tabs:t.tabs},null,8,["tabs"]),t.failedFetch?d("",!0):(r(),l(w,{key:0})),i(j,{modelValue:t.failedFetch,"onUpdate:modelValue":e[0]||(e[0]=L=>t.failedFetch=L),persistent:""},{default:s(()=>[i(D,{style:{"min-width":"350px"}},{default:s(()=>[i(B,null,{default:s(()=>[i(R,null,{default:s(()=>[i(P,null,{default:s(()=>[i(Q,{class:"text-h6 text-negative"},{default:s(()=>[b("Getting categories failed. ")]),_:1}),i(Q,{class:"text-info q-pt-lg"},{default:s(()=>[vt,Ct,kt]),_:1})]),_:1})]),_:1})]),_:1}),i(W,{align:"right",class:"text-primary"},{default:s(()=>[M(i(G,{flat:"",label:"ok",to:"/settings"},null,512),[[S]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["style-fn"])}var se=k($t,[["render",_t]]);export{se as default};
