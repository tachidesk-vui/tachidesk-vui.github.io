import{Q as B,a as _}from"./QItemLabel.43ea2709.js";import{Q as P}from"./QItem.ddf44946.js";import{Q as R}from"./QCardSection.460c5ef8.js";import{u as F,a as V,Q as W}from"./QBtn.83cc7836.js";import{Q as G}from"./QCardActions.8c792399.js";import{Q as I}from"./QCard.f6a06634.js";import{Q as j}from"./QDialog.59defe17.js";import{Q as z}from"./QPage.fd3498d9.js";import{C as S}from"./ClosePopup.7c183214.js";import{u as A,a as H,b as N,Q as U}from"./QTabs.d6ab1592.js";import{c as E}from"./QSpinner.992dc9e3.js";import{c as O,w as J,d as k,r as u,_ as C,a9 as K,aa as X,f as s,v as h,u as m,m as i,k as r,F as q,x as T,q as f,j as l,s as v,y as M,ab as p,p as b,t as c,n as d,ac as Y}from"./index.16a21bb1.js";import{Q as Z}from"./QIntersection.16e3c7e8.js";import{Q}from"./QInnerLoading.c2ee7d9e.js";import{Q as $}from"./QBadge.47e28206.js";import{g as x,Q as D}from"./usefull.5949ebbf.js";import{R as tt}from"./Ripple.0063342c.js";import{u as et}from"./Filters.74c8a9a6.js";import"./use-dark.3d2c1956.js";import"./QIcon.b4c56408.js";import"./use-transition.8cb170ff.js";import"./focus-manager.32f8d49a.js";import"./scroll.37cff1b1.js";import"./dom.1d14d0d9.js";import"./uid.42677368.js";import"./QResizeObserver.033b7cbf.js";import"./rtl.b51694b1.js";import"./Intersection.4f2ff861.js";import"./axios.5660c961.js";import"./StoreStuff.3cd89d8c.js";import"./getenv.7492fdf7.js";var at=E({name:"QRouteTab",props:{...F,...A},emits:H,setup(t,{slots:e,emit:a}){const n=V({useDisableForRouterLinkProps:!1}),{renderTab:g,$tabs:y}=N(t,e,a,{exact:O(()=>t.exact),...n});return J(()=>`${t.name} | ${t.exact} | ${(n.resolvedLink.value||{}).href}`,()=>{y.verifyRouteModel()}),()=>g(n.linkTag.value,n.linkAttrs.value)}});const rt=k({name:"TabPanel",props:{tabs:{type:Array,default:()=>[]}},setup(){const t=K(),e=X();return e.query.tab===void 0&&t.replace({query:{...e.query,tab:0}}),{tab:u(new Number(e.query.tab).valueOf()||0)}}}),st={class:""},it={class:"q-gutter-y-md"};function ot(t,e,a,n,g,y){return s(),h("div",st,[m("div",it,[i(U,{modelValue:t.tab,"onUpdate:modelValue":e[0]||(e[0]=o=>t.tab=o),"inline-label":"",class:f(t.$q.dark.isActive?"bg-dark-page":"bg-light-page")},{default:r(()=>[(s(!0),h(q,null,T(t.tabs,o=>(s(),l(at,{key:o.tabID,name:o.tabID,label:o.tabname,class:f(["col-grow",t.$route.query.tab==o.tabID.toString()?"text-primary":""]),flat:"",to:{query:{...t.$route.query,tab:o.tabID}}},null,8,["name","label","to","class"]))),128))]),_:1},8,["modelValue","class"])])])}var nt=C(rt,[["render",ot]]);const lt=k({name:"MangaCard",props:{manga:{type:Object,default:()=>Object},display:{type:String,default:"compact"},ubadge:{type:Boolean,default:!0},dbadge:{type:Boolean,default:!0}},setup(){return{imgdata:u("")}},computed:{listdivClass(){return this.display=="list"?"text-left q-ml-md text-h5 col-shrink":"text-center text-subtitle1"}},mounted:function(){x(this.manga.thumbnailUrl).then(t=>{this.imgdata=t})}}),dt={class:"transparent absolute-top q-mt-xs q-ml-xs",style:{padding:"0"}},ut=["title"],mt={class:"row items-center col-grow no-wrap"},pt=["title"];function ct(t,e,a,n,g,y){const o=v("router-link");return M((s(),l(I,{flat:"",class:f(["my-card",t.$q.screen.sm||t.$q.screen.xs?"q-ma-xs":"q-ma-sm"]),style:p(t.display=="list"?"":"background: transparent")},{default:r(()=>[i(o,{to:"/manga/"+t.manga.id,class:f(["cursor-pointer",t.$q.dark.isActive?"light":"dark"]),style:{"text-decoration":"none"}},{default:r(()=>[t.display!="list"?(s(),l(D,{key:0,src:t.imgdata,loading:"lazy","spinner-color":"white",style:{"max-width":"100%","aspect-ratio":"225/350"},class:"rounded-borders","no-spinner":""},{default:r(()=>[i(Q,{showing:!t.imgdata,color:"primary"},null,8,["showing"]),m("div",dt,[t.manga.unreadCount&&t.ubadge?(s(),l($,{key:0,color:"blue",style:p([{width:"min-content",padding:"5px"},t.manga.downloadCount?"border-top-right-radius: 0;border-bottom-right-radius: 0;":""])},{default:r(()=>[b(c(t.manga.unreadCount),1)]),_:1},8,["style"])):d("",!0),t.manga.downloadCount&&t.dbadge?(s(),l($,{key:1,color:"green",style:p([{width:"min-content",padding:"5px"},t.manga.unreadCount?"border-top-left-radius: 0;border-bottom-left-radius: 0;":""])},{default:r(()=>[b(c(t.manga.downloadCount),1)]),_:1},8,["style"])):d("",!0)]),t.display=="compact"?(s(),h("div",{key:0,class:"absolute-bottom text-subtitle1 text-center",title:t.manga.title,style:{padding:"0",display:"-webkit-box","-webkit-line-clamp":"2","-webkit-box-orient":"vertical","text-overflow":"ellipsis",height:"3.5rem"}},c(t.manga.title),9,ut)):d("",!0)]),_:1},8,["src"])):d("",!0),m("div",mt,[t.display=="list"?(s(),l(D,{key:0,src:t.imgdata,loading:"lazy","spinner-color":"white",style:{height:"93px","aspect-ratio":"225/350",width:"fit-content"},class:"rounded-borders items-center justify-center col-1","no-spinner":""},{default:r(()=>[i(Q,{showing:!t.imgdata,color:"primary"},null,8,["showing"])]),_:1},8,["src"])):d("",!0),t.display!="compact"?(s(),h("div",{key:1,class:f(t.listdivClass),title:t.manga.title,style:p([{padding:"0",display:"-webkit-box","-webkit-line-clamp":"3","-webkit-box-orient":"vertical","text-overflow":"ellipsis",overflow:"hidden",width:"100%"},t.display=="list"?"":"height: 5.25rem;"])},c(t.manga.title),15,pt)):d("",!0),m("div",{class:f(["justify-end flex items-end col-grow",t.$q.screen.sm||t.$q.screen.xs?"q-mr-xs":"q-mr-lg"])},[t.manga.unreadCount&&t.display=="list"&&t.ubadge?(s(),l($,{key:0,color:"blue",style:p([{width:"min-content",padding:"5px"},t.manga.downloadCount?"border-top-right-radius: 0;border-bottom-right-radius: 0;":""])},{default:r(()=>[b(c(t.manga.unreadCount),1)]),_:1},8,["style"])):d("",!0),t.manga.downloadCount&&t.display=="list"&&t.dbadge?(s(),l($,{key:1,color:"green",style:p([{width:"min-content",padding:"5px"},t.manga.unreadCount?"border-top-left-radius: 0;border-bottom-left-radius: 0;":""])},{default:r(()=>[b(c(t.manga.downloadCount),1)]),_:1},8,["style"])):d("",!0)],2)])]),_:1},8,["to","class"])]),_:1},8,["class","style"])),[[tt]])}var ft=C(lt,[["render",ct],["__scopeId","data-v-7dc7ee0a"]]);const ht=k({name:"MangaGrid",components:{MangaCard:ft},setup(){const t=u(et()),e=u(0),a=u(0),n=u([]);return{devider:e,mangas:n,filters:t,clwidth:a}},computed:{doFilt(){let t=this.mangas;return this.$route.query.q&&(t=t.filter(e=>e.title.toLowerCase().includes(`${this.$route.query.q||""}`.toLowerCase()))),this.filters.unread!=null&&(t=t.filter(e=>this.filters.unread?!!e.unreadCount:!e.unreadCount)),this.filters.downloaded!=null&&(t=t.filter(e=>this.filters.downloaded?!!e.downloadCount:!e.downloadCount)),t},dosrt(){let t=this.doFilt;return this.filters.leftToRead!=null&&(t=t.sort((e,a)=>this.filters.leftToRead?e.unreadCount>=a.unreadCount?-1:1:e.unreadCount<=a.unreadCount?-1:1)),this.filters.alphabetical!=null&&(t=t.sort((e,a)=>this.filters.alphabetical?e.title>=a.title?-1:1:e.title<=a.title?-1:1)),this.filters.ByID!=null&&(t=t.sort((e,a)=>this.filters.ByID?e.id>=a.id?-1:1:e.id<=a.id?-1:1)),t},Displ(){return this.filters.Display==null?"compact":this.filters.Display?"comfort":"list"},widt(){return this.Displ=="list"?"width:100%; height: 109px;":`width: calc(100% / ${this.devider}); aspect-ratio: 225/350;transition: width 0.5s ease-out;`}},watch:{"$route.query.tab":async function(t){this.reload(t)}},created:async function(){this.calcWidth=Y(this.calcWidth,500),this.reload(this.$route.query.tab)},mounted:function(){this.calcWidth(),this.$nextTick(()=>{window.addEventListener("resize",this.calcWidth)})},beforeUnmount(){window.removeEventListener("resize",this.calcWidth)},methods:{calcWidth(){const t=this.$refs.MangaGrid,e=this.$storeGet("MitemW",300);t.clientWidth!=null&&(this.devider=Math.round(t.clientWidth/e))},calcHeight(){var e;const t=(e=this.$parent)==null?void 0:e.$el;if(t){let a=t.clientHeight;return a-=t.children[0].clientHeight,a}return 0},async reload(t){t!=null&&(this.mangas=[],this.mangas=(await this.$api.get(`/api/v1/category/${this.$route.query.tab}`)).data)}}}),gt={ref:"MangaGrid",class:"flex"};function yt(t,e,a,n,g,y){const o=v("MangaCard");return s(),h(q,null,[m("div",gt,[(s(!0),h(q,null,T(t.dosrt,w=>(s(),l(Z,{key:w.id,style:p(t.widt),transition:"fade"},{default:r(()=>[i(o,{display:t.Displ,ubadge:t.filters.Ubadge,dbadge:t.filters.Dbadge,manga:w},null,8,["display","ubadge","dbadge","manga"])]),_:2},1032,["style"]))),128))],512),i(Q,{style:{position:"fixed",left:"50%",top:"50%",transform:"translate(-50%, -50%)",width:"fit-content",height:"fit-content","background-color":"transparent"},showing:!t.dosrt.length,color:"primary"},null,8,["showing"])],64)}var bt=C(ht,[["render",yt]]);const wt=k({name:"LibraryPage",components:{TabPanel:nt,MangaGrid:bt},emits:["set-title"],setup(t,{emit:e}){e("set-title","Library");const a=u([]),n=u(!1);return{tabs:a,failedFetch:n}},created:async function(){var t;try{const e=await this.$api.get("/api/v1/category");this.tabs=e.data.map(a=>({tabname:a.name,tabID:a.id})),this.$router.replace({query:{...this.$route.query,tab:((t=this.tabs[0])==null?void 0:t.tabID)||0}})}catch{this.failedFetch=!0}},methods:{myTweak(t){return{height:t?`calc(100vh - ${t}px)`:"100vh"}}}}),$t=m("div",null,"Have you set your server address?",-1),vt=m("div",null,"Is the server running?",-1),kt=m("div",{class:"q-pt-sm"}," Pressing Ok will take you to the settings page ",-1);function Ct(t,e,a,n,g,y){const o=v("TabPanel"),w=v("MangaGrid");return s(),l(z,{"style-fn":t.myTweak},{default:r(()=>[i(o,{active:"",tabs:t.tabs},null,8,["tabs"]),t.failedFetch?d("",!0):(s(),l(w,{key:0})),i(j,{modelValue:t.failedFetch,"onUpdate:modelValue":e[0]||(e[0]=L=>t.failedFetch=L),persistent:""},{default:r(()=>[i(I,{style:{"min-width":"350px"}},{default:r(()=>[i(R,null,{default:r(()=>[i(P,null,{default:r(()=>[i(B,null,{default:r(()=>[i(_,{class:"text-h6 text-negative"},{default:r(()=>[b("Getting categories failed. ")]),_:1}),i(_,{class:"text-info q-pt-lg"},{default:r(()=>[$t,vt,kt]),_:1})]),_:1})]),_:1})]),_:1}),i(G,{align:"right",class:"text-primary"},{default:r(()=>[M(i(W,{flat:"",label:"ok",to:"/settings"},null,512),[[S]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["style-fn"])}var ee=C(wt,[["render",Ct]]);export{ee as default};
