import{Q as L,a as _}from"./QItemLabel.bc894da5.js";import{Q as B}from"./QItem.3b00e4c6.js";import{Q as P}from"./QCardSection.dac8ef2a.js";import{u as F,a as V,Q as A}from"./QBtn.239ac4bd.js";import{Q as W}from"./QCardActions.6881b8dd.js";import{Q as I}from"./QCard.b23e52e7.js";import{Q as G}from"./QDialog.fd3f2ebf.js";import{Q as j}from"./QPage.15fd8730.js";import{C as z}from"./ClosePopup.cd64af8f.js";import{u as S,a as H,b as N,Q as U}from"./QTabs.e9ea76fd.js";import{c as E}from"./QSpinner.a066f13a.js";import{c as O,w as J,d as k,r as u,_ as C,a9 as K,aa as X,f as r,v as h,u as m,m as i,k as s,F as q,x as R,q as f,j as l,s as v,y as T,ab as p,p as b,t as c,n as d,ac as Y}from"./index.e607ebbf.js";import{Q as Z}from"./QIntersection.6eec15bc.js";import{Q}from"./QInnerLoading.c515810d.js";import{Q as $}from"./QBadge.2e1d392f.js";import{g as x,Q as D}from"./usefull.2dc78a7a.js";import{R as tt}from"./Ripple.e079ce52.js";import{u as et}from"./Filters.4ea6c65e.js";import"./use-dark.5a95c9ad.js";import"./QIcon.872d3216.js";import"./use-transition.ff15bca0.js";import"./focus-manager.32f8d49a.js";import"./scroll.d09d2b62.js";import"./dom.a3995931.js";import"./uid.42677368.js";import"./QResizeObserver.efd16df7.js";import"./rtl.b51694b1.js";import"./Intersection.db333c73.js";import"./axios.adfc46d0.js";import"./StoreStuff.8dd7626e.js";import"./getenv.7492fdf7.js";var at=E({name:"QRouteTab",props:{...F,...S},emits:H,setup(t,{slots:e,emit:a}){const o=V({useDisableForRouterLinkProps:!1}),{renderTab:g,$tabs:y}=N(t,e,a,{exact:O(()=>t.exact),...o});return J(()=>`${t.name} | ${t.exact} | ${(o.resolvedLink.value||{}).href}`,()=>{y.verifyRouteModel()}),()=>g(o.linkTag.value,o.linkAttrs.value)}});const st=k({name:"TabPanel",props:{tabs:{type:Array,default:()=>[]}},setup(){const t=K(),e=X();return e.query.tab===void 0&&t.replace({query:{...e.query,tab:0}}),{tab:u(new Number(e.query.tab).valueOf()||0)}}}),rt={class:""},it={class:"q-gutter-y-md"};function nt(t,e,a,o,g,y){return r(),h("div",rt,[m("div",it,[i(U,{modelValue:t.tab,"onUpdate:modelValue":e[0]||(e[0]=n=>t.tab=n),"inline-label":"",class:f(t.$q.dark.isActive?"bg-dark-page":"bg-light-page")},{default:s(()=>[(r(!0),h(q,null,R(t.tabs,n=>(r(),l(at,{key:n.tabID,name:n.tabID,label:n.tabname,class:f(["col-grow",t.$route.query.tab==n.tabID.toString()?"text-primary":""]),flat:"",to:{query:{...t.$route.query,tab:n.tabID}}},null,8,["name","label","to","class"]))),128))]),_:1},8,["modelValue","class"])])])}var ot=C(st,[["render",nt]]);const lt=k({name:"MangaCard",props:{manga:{type:Object,default:()=>Object},display:{type:String,default:"compact"},ubadge:{type:Boolean,default:!0},dbadge:{type:Boolean,default:!0}},setup(){return{imgdata:u("")}},computed:{listdivClass(){return this.display=="list"?"text-left q-ml-md text-h5 col-shrink":"text-center text-subtitle1"}},mounted:function(){x(this.manga.thumbnailUrl).then(t=>{this.imgdata=t})}}),dt={class:"transparent absolute-top q-mt-xs q-ml-xs",style:{padding:"0"}},ut=["title"],mt={class:"row items-center col-grow no-wrap"},pt=["title"];function ct(t,e,a,o,g,y){const n=v("router-link");return T((r(),l(I,{flat:"",class:f(["my-card",t.$q.screen.sm||t.$q.screen.xs?"q-ma-xs":"q-ma-sm"]),style:p(t.display=="list"?"":"background: transparent")},{default:s(()=>[i(n,{to:"/manga/"+t.manga.id,class:f(["cursor-pointer",t.$q.dark.isActive?"light":"dark"]),style:{"text-decoration":"none"}},{default:s(()=>[t.display!="list"?(r(),l(D,{key:0,src:t.imgdata,loading:"lazy","spinner-color":"white",style:{"max-width":"100%","aspect-ratio":"225/350"},class:"rounded-borders","no-spinner":""},{default:s(()=>[i(Q,{showing:!t.imgdata,color:"primary"},null,8,["showing"]),m("div",dt,[t.manga.unreadCount&&t.ubadge?(r(),l($,{key:0,color:"blue",style:p([{width:"min-content",padding:"5px"},t.manga.downloadCount?"border-top-right-radius: 0;border-bottom-right-radius: 0;":""])},{default:s(()=>[b(c(t.manga.unreadCount),1)]),_:1},8,["style"])):d("",!0),t.manga.downloadCount&&t.dbadge?(r(),l($,{key:1,color:"green",style:p([{width:"min-content",padding:"5px"},t.manga.unreadCount?"border-top-left-radius: 0;border-bottom-left-radius: 0;":""])},{default:s(()=>[b(c(t.manga.downloadCount),1)]),_:1},8,["style"])):d("",!0)]),t.display=="compact"?(r(),h("div",{key:0,class:"absolute-bottom text-subtitle1 text-center",title:t.manga.title,style:{padding:"0",display:"-webkit-box","-webkit-line-clamp":"2","-webkit-box-orient":"vertical","text-overflow":"ellipsis",height:"3.5rem"}},c(t.manga.title),9,ut)):d("",!0)]),_:1},8,["src"])):d("",!0),m("div",mt,[t.display=="list"?(r(),l(D,{key:0,src:t.imgdata,loading:"lazy","spinner-color":"white",style:{height:"93px","aspect-ratio":"225/350",width:"fit-content"},class:"rounded-borders items-center justify-center col-1","no-spinner":""},{default:s(()=>[i(Q,{showing:!t.imgdata,color:"primary"},null,8,["showing"])]),_:1},8,["src"])):d("",!0),t.display!="compact"?(r(),h("div",{key:1,class:f(t.listdivClass),title:t.manga.title,style:p([{padding:"0",display:"-webkit-box","-webkit-line-clamp":"3","-webkit-box-orient":"vertical","text-overflow":"ellipsis",overflow:"hidden",width:"100%"},t.display=="list"?"":"height: 5.25rem;"])},c(t.manga.title),15,pt)):d("",!0),m("div",{class:f(["justify-end flex items-end col-grow",t.$q.screen.sm||t.$q.screen.xs?"q-mr-xs":"q-mr-lg"])},[t.manga.unreadCount&&t.display=="list"&&t.ubadge?(r(),l($,{key:0,color:"blue",style:p([{width:"min-content",padding:"5px"},t.manga.downloadCount?"border-top-right-radius: 0;border-bottom-right-radius: 0;":""])},{default:s(()=>[b(c(t.manga.unreadCount),1)]),_:1},8,["style"])):d("",!0),t.manga.downloadCount&&t.display=="list"&&t.dbadge?(r(),l($,{key:1,color:"green",style:p([{width:"min-content",padding:"5px"},t.manga.unreadCount?"border-top-left-radius: 0;border-bottom-left-radius: 0;":""])},{default:s(()=>[b(c(t.manga.downloadCount),1)]),_:1},8,["style"])):d("",!0)],2)])]),_:1},8,["to","class"])]),_:1},8,["class","style"])),[[tt]])}var ft=C(lt,[["render",ct],["__scopeId","data-v-7dc7ee0a"]]);const ht=k({name:"MangaGrid",components:{MangaCard:ft},setup(){const t=u(et()),e=u(0),a=u(0),o=u([]);return{devider:e,mangas:o,filters:t,clwidth:a}},computed:{doFilt(){let t=this.mangas;return this.$route.query.q&&(t=t.filter(e=>e.title.toLowerCase().includes(`${this.$route.query.q||""}`.toLowerCase()))),this.filters.unread!=null&&(t=t.filter(e=>this.filters.unread?!!e.unreadCount:!e.unreadCount)),this.filters.downloaded!=null&&(t=t.filter(e=>this.filters.downloaded?!!e.downloadCount:!e.downloadCount)),t},dosrt(){let t=this.doFilt;return this.filters.leftToRead!=null&&(t=t.sort((e,a)=>this.filters.leftToRead?e.unreadCount>=a.unreadCount?-1:1:e.unreadCount<=a.unreadCount?-1:1)),this.filters.alphabetical!=null&&(t=t.sort((e,a)=>this.filters.alphabetical?e.title>=a.title?-1:1:e.title<=a.title?-1:1)),this.filters.lastRead!=null&&(t=t.sort((e,a)=>this.filters.lastRead?e.lastReadAt<=a.lastReadAt?-1:1:e.lastReadAt>=a.lastReadAt?-1:1)),this.filters.ByID!=null&&(t=t.sort((e,a)=>this.filters.ByID?e.id>=a.id?-1:1:e.id<=a.id?-1:1)),t},Displ(){return this.filters.Display==null?"compact":this.filters.Display?"comfort":"list"},widt(){return this.Displ=="list"?"width:100%; height: 109px;":`width: calc(100% / ${this.devider}); aspect-ratio: 225/350;transition: width 0.5s ease-out;`}},watch:{"$route.query.tab":async function(t){this.reload(t)}},created:async function(){this.calcWidth=Y(this.calcWidth,500),this.reload(this.$route.query.tab)},mounted:function(){this.calcWidth(),this.$nextTick(()=>{window.addEventListener("resize",this.calcWidth)})},beforeUnmount(){window.removeEventListener("resize",this.calcWidth)},methods:{calcWidth(){const t=this.$refs.MangaGrid,e=this.$storeGet("MitemW",300);t.clientWidth!=null&&(this.devider=Math.round(t.clientWidth/e))},calcHeight(){var e;const t=(e=this.$parent)==null?void 0:e.$el;if(t){let a=t.clientHeight;return a-=t.children[0].clientHeight,a}return 0},async reload(t){t!=null&&(this.mangas=[],this.mangas=(await this.$api.get(`/api/v1/category/${this.$route.query.tab}`)).data)}}}),gt={ref:"MangaGrid",class:"flex"};function yt(t,e,a,o,g,y){const n=v("MangaCard");return r(),h(q,null,[m("div",gt,[(r(!0),h(q,null,R(t.dosrt,w=>(r(),l(Z,{key:w.id,style:p(t.widt),transition:"fade"},{default:s(()=>[i(n,{display:t.Displ,ubadge:t.filters.Ubadge,dbadge:t.filters.Dbadge,manga:w},null,8,["display","ubadge","dbadge","manga"])]),_:2},1032,["style"]))),128))],512),i(Q,{style:{position:"fixed",left:"50%",top:"50%",transform:"translate(-50%, -50%)",width:"fit-content",height:"fit-content","background-color":"transparent"},showing:!t.dosrt.length,color:"primary"},null,8,["showing"])],64)}var bt=C(ht,[["render",yt]]);const wt=k({name:"LibraryPage",components:{TabPanel:ot,MangaGrid:bt},emits:["set-title"],setup(t,{emit:e}){e("set-title","Library");const a=u([]),o=u(!1);return{tabs:a,failedFetch:o}},created:async function(){var t;try{const e=await this.$api.get("/api/v1/category");this.tabs=e.data.map(a=>({tabname:a.name,tabID:a.id})),this.$router.replace({query:{...this.$route.query,tab:((t=this.tabs[0])==null?void 0:t.tabID)||0}})}catch{this.failedFetch=!0}},methods:{myTweak(t){return{height:t?`calc(100vh - ${t}px)`:"100vh"}}}}),$t=m("div",null,"Have you set your server address?",-1),vt=m("div",null,"Is the server running?",-1),kt=m("div",{class:"q-pt-sm"}," Pressing Ok will take you to the settings page ",-1);function Ct(t,e,a,o,g,y){const n=v("TabPanel"),w=v("MangaGrid");return r(),l(j,{"style-fn":t.myTweak},{default:s(()=>[i(n,{active:"",tabs:t.tabs},null,8,["tabs"]),t.failedFetch?d("",!0):(r(),l(w,{key:0})),i(G,{modelValue:t.failedFetch,"onUpdate:modelValue":e[0]||(e[0]=M=>t.failedFetch=M),persistent:""},{default:s(()=>[i(I,{style:{"min-width":"350px"}},{default:s(()=>[i(P,null,{default:s(()=>[i(B,null,{default:s(()=>[i(L,null,{default:s(()=>[i(_,{class:"text-h6 text-negative"},{default:s(()=>[b("Getting categories failed. ")]),_:1}),i(_,{class:"text-info q-pt-lg"},{default:s(()=>[$t,vt,kt]),_:1})]),_:1})]),_:1})]),_:1}),i(W,{align:"right",class:"text-primary"},{default:s(()=>[T(i(A,{flat:"",label:"ok",to:"/settings"},null,512),[[z]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["style-fn"])}var ee=C(wt,[["render",Ct]]);export{ee as default};
