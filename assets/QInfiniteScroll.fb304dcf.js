import{c as Q,d as k,h as w}from"./QSpinner.a066f13a.js";import{r as b,c as A,w as f,K as O,L as U,o as V,C as _,h as T,S as j,D as F,ac as K,g as R}from"./index.e607ebbf.js";import{h as H}from"./dom.a3995931.js";import{d as v,c as S,s as L,a as W}from"./scroll.d09d2b62.js";const{passive:s}=j;var Y=Q({name:"QInfiniteScroll",props:{offset:{type:Number,default:500},debounce:{type:[String,Number],default:100},scrollTarget:{default:void 0},initialIndex:Number,disable:Boolean,reverse:Boolean},emits:["load"],setup(l,{slots:x,emit:N}){const n=b(!1),a=b(!0),u=b(null);let c=l.initialIndex||0,e,i;const y=A(()=>"q-infinite-scroll__loading"+(n.value===!0?"":" invisible"));function o(){if(l.disable===!0||n.value===!0||a.value===!1)return;const t=v(e),r=S(e),m=H(e);l.reverse===!1?Math.round(r+m+l.offset)>=Math.round(t)&&d():Math.round(r)<=l.offset&&d()}function d(){if(l.disable===!0||n.value===!0||a.value===!1)return;c++,n.value=!0;const t=v(e);N("load",c,r=>{a.value===!0&&(n.value=!1,F(()=>{if(l.reverse===!0){const m=v(e),q=S(e),C=m-t;L(e,q+C)}r===!0?g():u.value&&u.value.closest("body")&&i()}))})}function B(){c=0}function E(){a.value===!1&&(a.value=!0,e.addEventListener("scroll",i,s)),o()}function g(){a.value===!0&&(a.value=!1,n.value=!1,e.removeEventListener("scroll",i,s),i!==void 0&&i.cancel!==void 0&&i.cancel())}function I(){if(e&&a.value===!0&&e.removeEventListener("scroll",i,s),e=W(u.value,l.scrollTarget),a.value===!0){if(e.addEventListener("scroll",i,s),l.reverse===!0){const t=v(e),r=H(e);L(e,t-r)}o()}}function D(t){c=t}function P(t){t=parseInt(t,10);const r=i;i=t<=0?o:K(o,isNaN(t)===!0?100:t),e&&a.value===!0&&(r!==void 0&&e.removeEventListener("scroll",r,s),e.addEventListener("scroll",i,s))}f(()=>l.disable,t=>{t===!0?g():E()}),f(()=>l.reverse,t=>{n.value===!1&&a.value===!0&&o()}),f(()=>l.scrollTarget,I),f(()=>l.debounce,P);let h=!1;O(()=>{h!==!1&&e&&L(e,h)}),U(()=>{h=e?S(e):!1}),V(()=>{a.value===!0&&e.removeEventListener("scroll",i,s)}),_(()=>{P(l.debounce),I()});const M=R();return Object.assign(M.proxy,{poll:()=>{i!==void 0&&i()},trigger:d,stop:g,reset:B,resume:E,setIndex:D}),()=>{const t=k(x.default,[]);return l.disable!==!0&&a.value===!0&&t[l.reverse===!1?"push":"unshift"](T("div",{class:y.value},w(x.loading))),T("div",{class:"q-infinite-scroll",ref:u},t)}}});export{Y as Q};
