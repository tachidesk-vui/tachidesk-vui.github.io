import{Q as E}from"./QIntersection.e95f45ae.js";import{Q as I}from"./QList.e189fe10.js";import{Q as v}from"./QInnerLoading.f77c1099.js";import{Q as b}from"./QPage.bc302bb1.js";import{i as d}from"./models.d7e94ac2.js";import{g as N,Q as z}from"./usefull.fdd2b745.js";import{Q as k,a as $}from"./QItemLabel.0edef075.js";import{Q as F}from"./QBtn.bab6ec57.js";import{Q as B}from"./QItem.0d9b1787.js";import{Q as A}from"./QCard.3d26f420.js";import{storeGet as S}from"./StoreStuff.9d64157b.js";import{d as Q,r as f,_ as U,f as n,j as c,k as a,m as r,u as C,p as y,t as m,v as h,n as x,q as L,s as V,x as w,F as _}from"./index.a3198c66.js";import{l as j}from"./language.588b8ace.js";import{u as G}from"./Filters.f9523176.js";import"./Intersection.7f53932d.js";import"./QSpinner.466aed6f.js";import"./use-dark.bb0a42ad.js";import"./use-transition.4799b52a.js";import"./axios.e10f683c.js";import"./getenv.7492fdf7.js";import"./QIcon.505025ec.js";import"./Ripple.997282a1.js";import"./dom.5b6c3993.js";const P=Q({name:"ExtCard",props:{exten:{type:Object,required:!0}},emits:["reload"],setup(){const t=f(`${S("useCache",!0)}`),e=f("");return{useCache:t,imgdata:e}},computed:{UpUnIn(){return this.exten.hasUpdate?"Update":this.exten.installed?"Uninstall":"Install"}},mounted:function(){N(this.exten.iconUrl+"?useCache="+this.useCache).then(t=>{this.imgdata=t})},methods:{capitalizeFirstLetter(t){return t.charAt(0).toUpperCase()+t.slice(1)},async HandleExt(){this.exten.hasUpdate?await this.$api.get(`/api/v1/extension/update/${this.exten.pkgName}`):this.exten.installed?await this.$api.get(`/api/v1/extension/uninstall/${this.exten.pkgName}`):await this.$api.get(`/api/v1/extension/install/${this.exten.pkgName}`),this.$emit("reload")}}}),T={class:"row content-center col-grow"},H={key:0,style:{color:"red"}},R={class:"flex items-center"};function D(t,e,i,o,u,s){return n(),c(A,{class:L(["q-ma-sm",t.$q.dark.isActive?"":"bg-light"])},{default:a(()=>[r(B,{style:{height:"100px"}},{default:a(()=>[C("div",T,[r(k,{avatar:""},{default:a(()=>[r(z,{src:t.imgdata,loading:"lazy","spinner-color":"white",style:{height:"100px","aspect-ratio":"225/225",width:"fit-content"},class:"rounded-borders items-center justify-center","no-spinner":""},{default:a(()=>[r(v,{showing:!t.imgdata,color:"primary",class:"bg-transparent"},null,8,["showing"])]),_:1},8,["src"])]),_:1}),r(k,{class:"flex-grow"},{default:a(()=>[r($,null,{default:a(()=>[y(m(t.capitalizeFirstLetter(t.exten.name)),1)]),_:1}),r($,{caption:""},{default:a(()=>[y(m(t.capitalizeFirstLetter(t.exten.lang))+" "+m(t.exten.versionName)+" ",1),t.exten.isNsfw?(n(),h("span",H,"18+")):x("",!0)]),_:1})]),_:1})]),C("div",R,[r(F,{outline:"",color:"blue",onClick:t.HandleExt},{default:a(()=>[r($,{class:L(t.$q.dark.isActive?"light":"dark")},{default:a(()=>[y(m(t.capitalizeFirstLetter(t.UpUnIn)),1)]),_:1},8,["class"])]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["class"])}var O=U(P,[["render",D]]);const J=Q({name:"SourcesPage",components:{extCard:O},emits:["set-title"],setup(t,{emit:e}){e("set-title","Extentions");const i=G(),o=i,u=f([]),s=f(i.langs);return{list:u,allLangs:[],filters:o,langs:s}},computed:{langGroups(){return this.groupExtensions(this.list)},filterList(){let t=this.langGroups;return t=t.map(e=>{let i=e[1];return this.$route.query.q&&(i=i.filter(o=>o.name.toLowerCase().includes(`${this.$route.query.q}`.toLowerCase()))),this.langs.includes(e[0])||(i=[]),[e[0],i]}),t}},created:function(){this.reload()},methods:{myTweak(t){return{height:t?`calc(100vh - ${t}px)`:"100vh"}},reload(){this.$api.get("/api/v1/extension/list").then(({data:t})=>{this.list=t})},groupExtensions(t){this.allLangs=[];const e={installed:[],"updates pending":[]};t.forEach(s=>{var p;const l=s.lang;e[l]==null&&(e[l]=[],l!=="all"&&this.allLangs.push(l)),s.installed?s.hasUpdate?d(e["updates pending"])&&e["updates pending"].push(s):d(e.installed)&&e.installed.push(s):(p=e[l])==null||p.push(s)}),this.allLangs.sort(j);const i=[["updates pending",d(e["updates pending"])?e["updates pending"]:[]],["installed",d(e.installed)?e.installed:[]],["all",d(e.all)?e.all:[]]];this.filters.setcurrlangs(this.allLangs);const o=this.allLangs.map(s=>[s,e[s]]).filter(s=>s[1]!=null);return i.concat(o)},capitalizeFirstLetter(t){return t.charAt(0).toUpperCase()+t.slice(1)}}}),K={key:0,class:"text-h4 q-ml-xl q-my-lg"};function M(t,e,i,o,u,s){const l=V("extCard");return n(),c(b,{"style-fn":t.myTweak},{default:a(()=>[(n(!0),h(_,null,w(t.filterList,p=>(n(),c(I,{key:p[0]},{default:a(()=>[p[1].length?(n(),h("div",K,m(t.capitalizeFirstLetter(p[0])),1)):x("",!0),(n(!0),h(_,null,w(p[1],(g,q)=>(n(),c(E,{key:q,style:{height:"100px",width:"100%"},class:"flex-shrink"},{default:a(()=>[!g.obsolete||g.installed?(n(),c(l,{key:0,exten:g,onReload:t.reload},null,8,["exten","onReload"])):x("",!0)]),_:2},1024))),128))]),_:2},1024))),128)),r(v,{style:{position:"fixed",left:"50%",top:"50%",transform:"translate(-50%, -50%)",width:"fit-content",height:"fit-content","background-color":"transparent"},showing:t.filterList.length==3,color:"primary"},null,8,["showing"])]),_:1},8,["style-fn"])}var xt=U(J,[["render",M]]);export{xt as default};
