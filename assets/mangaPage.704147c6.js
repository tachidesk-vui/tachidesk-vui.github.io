import{Q as je}from"./QPage.bc302bb1.js";import{g as Ee,Q as ge}from"./usefull.fdd2b745.js";import{Q as V}from"./QBtn.bab6ec57.js";import{Q as Je,a as A}from"./QMenu.9fe19c52.js";import{storeGet as Ge,storeSet as R}from"./StoreStuff.9d64157b.js";import{d as Z,r as m,_ as x,f as u,v as z,j as b,n as $,u as M,q as Y,t as q,p,m as o,F as ce,x as qe,ab as De,k as l,c as C,ac as Ke,w as Xe,L as Ye,K as We,o as Ze,h as B,y,g as xe,V as ee,a4 as et,a5 as tt,a1 as G,a3 as ke,a2 as te,N as at,P as F,aa as Me,s as W,ak as lt}from"./index.a3198c66.js";import{Q as T}from"./QIcon.505025ec.js";import{Q as v,a as ae}from"./QItemLabel.0edef075.js";import{Q as g}from"./QItem.0d9b1787.js";import{Q as L}from"./QList.e189fe10.js";import{Q as ot}from"./QLinearProgress.eb95142a.js";import{Q as rt}from"./QIntersection.e95f45ae.js";import{u as nt,a as it}from"./use-dark.bb0a42ad.js";import{Q as ye}from"./QResizeObserver.119f7193.js";import{Q as st}from"./QScrollObserver.d5c126dc.js";import{T as ue}from"./TouchPan.c0301a84.js";import{c as dt,a as ut,f as ct}from"./QSpinner.466aed6f.js";import{b as K}from"./format.2a3572e1.js";import{e as le,s as $e}from"./scroll.c2f762e7.js";import{Q as mt}from"./QTooltip.7c7df63d.js";import{Q as ft}from"./QPageSticky.d12ac7fb.js";import{C as w}from"./ClosePopup.4420df8b.js";import{c as oe}from"./selection.41f9fdcd.js";import{R as ht}from"./Ripple.997282a1.js";import{p as Se}from"./models.d7e94ac2.js";import{Q as re}from"./QTab.b14f6374.js";import{Q as pt}from"./QTabs.9c31f81b.js";import{Q as P}from"./QCardSection.184ff173.js";import{Q as H}from"./QCheckbox.ca116a29.js";import{Q as we}from"./QRadio.b470e017.js";import{Q as vt}from"./QCard.3d26f420.js";import{Q as bt}from"./QDialog.dbe5c09d.js";import{u as gt}from"./useDlSock.bd82ced2.js";import"./axios.e10f683c.js";import"./getenv.7492fdf7.js";import"./position-engine.83414917.js";import"./use-transition.4799b52a.js";import"./dom.5b6c3993.js";import"./focus-manager.32f8d49a.js";import"./Intersection.7f53932d.js";import"./uid.42677368.js";import"./rtl.b51694b1.js";import"./use-checkbox.a4983d6a.js";import"./option-sizes.90e5f4ee.js";import"./use-form.82ce5902.js";const kt=Z({name:"MangaInfo",props:{manga:{type:Object,default:Object},offset:{type:Number,default:()=>0}},emits:["inlib"],setup(e){var c;return{useCache:Ge("useCache",!0),inLib:m(((c=e.manga)==null?void 0:c.inLibrary)||!1),imgdata:m()}},created:function(){if(this.imgdata&&this.manga)this.getImg();else{const e=this.$watch(()=>[this.imgdata,this.manga],()=>{!this.imgdata&&this.manga&&(this.getImg(),e())})}},methods:{async InLibrary(){this.inLib=!this.inLib,this.inLib?await this.$api.get(`/api/v1/manga/${this.$route.params.mangaID}/library/`):await this.$api.delete(`/api/v1/manga/${this.$route.params.mangaID}/library/`),this.$emit("inlib")},getImg(){var e;Ee(((e=this.manga)==null?void 0:e.thumbnailUrl)+"?useCache="+this.useCache).then(t=>{this.imgdata=t})}}}),yt={class:"flex no-wrap"},$t={key:1,class:"q-mx-md",style:{display:"inline-block"}},St={key:0,class:"text-h5 q-my-xs"},wt={class:"text-subtitle1"},Ct={key:1,class:"text-h5 q-my-xs"},_t={class:"text-subtitle1"},zt={key:2,class:"text-h5 q-my-xs"},qt={class:"text-subtitle1"},Dt={key:3,class:"text-h5 q-my-xs"},Mt={class:"text-subtitle1"},Qt={class:"q-my-md",style:{display:"flex","justify-content":"space-evenly"}},It={key:1},Bt=M("h6",{class:"q-my-sm"},"About:",-1),Ft={style:{"font-size":"1.3em"}},Pt={key:2};function Vt(e,t,c,d,S,h){var r,a,n,i,I,Q,_;return u(),z("div",{class:"q-px-md q-py-md col MangaInfo",style:De([{"overflow-y":"auto"},e.$q.screen.sm||e.$q.screen.xs?"":"max-height: calc(100vh - "+e.offset+"px)"])},[e.$q.screen.sm||e.$q.screen.xs||e.$q.screen.md?(u(),b(ge,{key:0,style:{width:"fit-content","max-width":"100%"},loading:"lazy",class:"rounded-borders q-mx-md","img-class":"test",src:e.imgdata,fit:"scale-down"},null,8,["src"])):$("",!0),M("div",yt,[e.$q.screen.sm||e.$q.screen.xs||e.$q.screen.md?$("",!0):(u(),b(ge,{key:0,style:{width:"fit-content","max-width":"50%",flex:"none"},loading:"lazy",class:"rounded-borders","img-class":"test",src:e.imgdata,fit:"scale-down"},null,8,["src"])),e.manga?(u(),z("div",$t,[M("h3",{style:{"overflow-wrap":"anywhere"},class:Y(e.$q.screen.sm||e.$q.screen.xs||e.$q.screen.md?"q-my-sm":"")},q(e.manga.title),3),e.manga.author?(u(),z("div",St,[p(" Author: "),M("span",wt,q(e.manga.author),1)])):$("",!0),e.manga.artist?(u(),z("div",Ct,[p(" Artist: "),M("span",_t,q(e.manga.artist),1)])):$("",!0),e.manga.status?(u(),z("div",zt,[p(" Status: "),M("span",qt,q(e.manga.status),1)])):$("",!0),(r=e.manga.source)!=null&&r.displayName?(u(),z("div",Dt,[p(" Source: "),M("span",Mt,q((a=e.manga.source)==null?void 0:a.displayName),1)])):$("",!0)])):$("",!0)]),M("div",Qt,[o(V,{flat:"",color:(n=e.manga)!=null&&n.inLibrary?"primary":"grey-9",icon:"favorite",label:(i=e.manga)!=null&&i.inLibrary?"In Library":"Add To Library",onClick:e.InLibrary},null,8,["color","label","onClick"]),o(V,{flat:"",color:"grey-9",icon:"public",label:"Open Site",href:(I=e.manga)==null?void 0:I.realUrl,target:"_blank"},null,8,["href"])]),(Q=e.manga)!=null&&Q.description?(u(),z("div",It,[Bt,M("p",Ft,q(e.manga.description),1)])):$("",!0),(_=e.manga)!=null&&_.genre?(u(),z("div",Pt,[(u(!0),z(ce,null,qe(e.manga.genre,D=>(u(),b(Je,{key:D,outline:"",color:"primary"},{default:l(()=>[p(q(D),1)]),_:2},1024))),128))])):$("",!0)],4)}var Ut=x(kt,[["render",Vt]]);const Ce=["vertical","horizontal"],ne={vertical:{offset:"offsetY",scroll:"scrollTop",dir:"down",dist:"y"},horizontal:{offset:"offsetX",scroll:"scrollLeft",dir:"right",dist:"x"}},_e={prevent:!0,mouse:!0,mouseAllDir:!0},ze=e=>e>=250?50:Math.ceil(e/5);var At=dt({name:"QScrollArea",props:{...nt,thumbStyle:Object,verticalThumbStyle:Object,horizontalThumbStyle:Object,barStyle:[Array,String,Object],verticalBarStyle:[Array,String,Object],horizontalBarStyle:[Array,String,Object],contentStyle:[Array,String,Object],contentActiveStyle:[Array,String,Object],delay:{type:[String,Number],default:1e3},visible:{type:Boolean,default:null},tabindex:[String,Number],onScroll:Function},setup(e,{slots:t,emit:c}){const d=m(!1),S=m(!1),h=m(!1),r={vertical:m(0),horizontal:m(0)},a={vertical:{ref:m(null),position:m(0),size:m(0)},horizontal:{ref:m(null),position:m(0),size:m(0)}},{proxy:n}=xe(),i=it(e,n.$q);let I,Q;const _=m(null),D=C(()=>"q-scrollarea"+(i.value===!0?" q-scrollarea--dark":""));a.vertical.percentage=C(()=>{const s=a.vertical.size.value-r.vertical.value;if(s<=0)return 0;const f=K(a.vertical.position.value/s,0,1);return Math.round(f*1e4)/1e4}),a.vertical.thumbHidden=C(()=>(e.visible===null?h.value:e.visible)!==!0&&d.value===!1&&S.value===!1||a.vertical.size.value<=r.vertical.value+1),a.vertical.thumbStart=C(()=>a.vertical.percentage.value*(r.vertical.value-a.vertical.thumbSize.value)),a.vertical.thumbSize=C(()=>Math.round(K(r.vertical.value*r.vertical.value/a.vertical.size.value,ze(r.vertical.value),r.vertical.value))),a.vertical.style=C(()=>({...e.thumbStyle,...e.verticalThumbStyle,top:`${a.vertical.thumbStart.value}px`,height:`${a.vertical.thumbSize.value}px`})),a.vertical.thumbClass=C(()=>"q-scrollarea__thumb q-scrollarea__thumb--v absolute-right"+(a.vertical.thumbHidden.value===!0?" q-scrollarea__thumb--invisible":"")),a.vertical.barClass=C(()=>"q-scrollarea__bar q-scrollarea__bar--v absolute-right"+(a.vertical.thumbHidden.value===!0?" q-scrollarea__bar--invisible":"")),a.horizontal.percentage=C(()=>{const s=a.horizontal.size.value-r.horizontal.value;if(s<=0)return 0;const f=K(Math.abs(a.horizontal.position.value)/s,0,1);return Math.round(f*1e4)/1e4}),a.horizontal.thumbHidden=C(()=>(e.visible===null?h.value:e.visible)!==!0&&d.value===!1&&S.value===!1||a.horizontal.size.value<=r.horizontal.value+1),a.horizontal.thumbStart=C(()=>a.horizontal.percentage.value*(r.horizontal.value-a.horizontal.thumbSize.value)),a.horizontal.thumbSize=C(()=>Math.round(K(r.horizontal.value*r.horizontal.value/a.horizontal.size.value,ze(r.horizontal.value),r.horizontal.value))),a.horizontal.style=C(()=>({...e.thumbStyle,...e.horizontalThumbStyle,[n.$q.lang.rtl===!0?"right":"left"]:`${a.horizontal.thumbStart.value}px`,width:`${a.horizontal.thumbSize.value}px`})),a.horizontal.thumbClass=C(()=>"q-scrollarea__thumb q-scrollarea__thumb--h absolute-bottom"+(a.horizontal.thumbHidden.value===!0?" q-scrollarea__thumb--invisible":"")),a.horizontal.barClass=C(()=>"q-scrollarea__bar q-scrollarea__bar--h absolute-bottom"+(a.horizontal.thumbHidden.value===!0?" q-scrollarea__bar--invisible":""));const Ie=C(()=>a.vertical.thumbHidden.value===!0&&a.horizontal.thumbHidden.value===!0?e.contentStyle:e.contentActiveStyle),Be=[[ue,s=>{pe(s,"vertical")},void 0,{vertical:!0,..._e}]],Fe=[[ue,s=>{pe(s,"horizontal")},void 0,{horizontal:!0,..._e}]];function me(){const s={};return Ce.forEach(f=>{const k=a[f];s[f+"Position"]=k.position.value,s[f+"Percentage"]=k.percentage.value,s[f+"Size"]=k.size.value,s[f+"ContainerSize"]=r[f].value}),s}const fe=Ke(()=>{const s=me();s.ref=n,c("scroll",s)},0);function he(s,f,k){if(Ce.includes(s)===!1){console.error("[QScrollArea]: wrong first param of setScrollPosition (vertical/horizontal)");return}(s==="vertical"?$e:le)(_.value,f,k)}function Pe({height:s,width:f}){let k=!1;r.vertical.value!==s&&(r.vertical.value=s,k=!0),r.horizontal.value!==f&&(r.horizontal.value=f,k=!0),k===!0&&j()}function Ve({position:s}){let f=!1;a.vertical.position.value!==s.top&&(a.vertical.position.value=s.top,f=!0),a.horizontal.position.value!==s.left&&(a.horizontal.position.value=s.left,f=!0),f===!0&&j()}function Ue({height:s,width:f}){a.horizontal.size.value!==f&&(a.horizontal.size.value=f,j()),a.vertical.size.value!==s&&(a.vertical.size.value=s,j())}function pe(s,f){const k=a[f];if(s.isFirst===!0){if(k.thumbHidden.value===!0)return;Q=k.position.value,S.value=!0}else if(S.value!==!0)return;s.isFinal===!0&&(S.value=!1);const U=ne[f],J=r[f].value,He=(k.size.value-J)/(J-k.thumbSize.value),Ne=s.distance[U.dist],Oe=Q+(s.direction===U.dir?1:-1)*Ne*He;be(Oe,f)}function ve(s,f){const k=a[f];if(k.thumbHidden.value!==!0){const U=s[ne[f].offset];if(U<k.thumbStart.value||U>k.thumbStart.value+k.thumbSize.value){const J=U-k.thumbSize.value/2;be(J/r[f].value*k.size.value,f)}k.ref.value!==null&&k.ref.value.dispatchEvent(new MouseEvent(s.type,s))}}function Ae(s){ve(s,"vertical")}function Te(s){ve(s,"horizontal")}function j(){d.value===!0?clearTimeout(I):d.value=!0,I=setTimeout(()=>{d.value=!1},e.delay),e.onScroll!==void 0&&fe()}function be(s,f){_.value[ne[f].scroll]=s}function Le(){h.value=!0}function Re(){h.value=!1}let E=null;return Xe(()=>n.$q.lang.rtl,s=>{_.value!==null&&le(_.value,Math.abs(a.horizontal.position.value)*(s===!0?-1:1))}),Ye(()=>{E={top:a.vertical.position.value,left:a.horizontal.position.value}}),We(()=>{if(E===null)return;const s=_.value;s!==null&&(le(s,E.left),$e(s,E.top))}),Ze(fe.cancel),Object.assign(n,{getScrollTarget:()=>_.value,getScroll:me,getScrollPosition:()=>({top:a.vertical.position.value,left:a.horizontal.position.value}),getScrollPercentage:()=>({top:a.vertical.percentage.value,left:a.horizontal.percentage.value}),setScrollPosition:he,setScrollPercentage(s,f,k){he(s,f*(a[s].size.value-r[s].value)*(s==="horizontal"&&n.$q.lang.rtl===!0?-1:1),k)}}),()=>B("div",{class:D.value,onMouseenter:Le,onMouseleave:Re},[B("div",{ref:_,class:"q-scrollarea__container scroll relative-position fit hide-scrollbar",tabindex:e.tabindex!==void 0?e.tabindex:void 0},[B("div",{class:"q-scrollarea__content absolute",style:Ie.value},ut(t.default,[B(ye,{debounce:0,onResize:Ue})])),B(st,{axis:"both",onScroll:Ve})]),B(ye,{debounce:0,onResize:Pe}),B("div",{class:a.vertical.barClass.value,style:[e.barStyle,e.verticalBarStyle],"aria-hidden":"true",onMousedown:Ae}),B("div",{class:a.horizontal.barClass.value,style:[e.barStyle,e.horizontalBarStyle],"aria-hidden":"true",onMousedown:Te}),y(B("div",{ref:a.vertical.ref,class:a.vertical.thumbClass.value,style:a.vertical.style.value,"aria-hidden":"true"}),Be),y(B("div",{ref:a.horizontal.ref,class:a.horizontal.thumbClass.value,style:a.horizontal.style.value,"aria-hidden":"true"}),Fe)])}}),Tt=ct({name:"touch-hold",beforeMount(e,t){const{modifiers:c}=t;if(c.mouse!==!0&&ee.has.touch!==!0)return;const d={handler:t.value,noop:et,mouseStart(h){typeof d.handler=="function"&&tt(h)===!0&&(G(d,"temp",[[document,"mousemove","move","passiveCapture"],[document,"click","end","notPassiveCapture"]]),d.start(h,!0))},touchStart(h){if(h.target!==void 0&&typeof d.handler=="function"){const r=h.target;G(d,"temp",[[r,"touchmove","move","passiveCapture"],[r,"touchcancel","end","notPassiveCapture"],[r,"touchend","end","notPassiveCapture"]]),d.start(h)}},start(h,r){d.origin=ke(h);const a=Date.now();ee.is.mobile===!0&&(document.body.classList.add("non-selectable"),oe(),d.styleCleanup=n=>{d.styleCleanup=void 0;const i=()=>{document.body.classList.remove("non-selectable")};n===!0?(oe(),setTimeout(i,10)):i()}),d.triggered=!1,d.sensitivity=r===!0?d.mouseSensitivity:d.touchSensitivity,d.timer=setTimeout(()=>{oe(),d.triggered=!0,d.handler({evt:h,touch:r!==!0,mouse:r===!0,position:d.origin,duration:Date.now()-a})},d.duration)},move(h){const{top:r,left:a}=ke(h);(Math.abs(a-d.origin.left)>=d.sensitivity||Math.abs(r-d.origin.top)>=d.sensitivity)&&clearTimeout(d.timer)},end(h){te(d,"temp"),d.styleCleanup!==void 0&&d.styleCleanup(d.triggered),d.triggered===!0?h!==void 0&&at(h):clearTimeout(d.timer)}},S=[600,5,7];if(typeof t.arg=="string"&&t.arg.length>0&&t.arg.split(":").forEach((h,r)=>{const a=parseInt(h,10);a&&(S[r]=a)}),[d.duration,d.touchSensitivity,d.mouseSensitivity]=S,e.__qtouchhold=d,c.mouse===!0){const h=c.mouseCapture===!0||c.mousecapture===!0?"Capture":"";G(d,"main",[[e,"mousedown","mouseStart",`passive${h}`]])}ee.has.touch===!0&&G(d,"main",[[e,"touchstart","touchStart",`passive${c.capture===!0?"Capture":""}`],[e,"touchend","noop","notPassiveCapture"]])},updated(e,t){const c=e.__qtouchhold;c!==void 0&&t.oldValue!==t.value&&(typeof t.value!="function"&&c.end(),c.handler=t.value)},beforeUnmount(e){const t=e.__qtouchhold;t!==void 0&&(te(t,"main"),te(t,"temp"),clearTimeout(t.timer),t.styleCleanup!==void 0&&t.styleCleanup(),delete e.__qtouchhold)}});const ie=m(null),se=m(null),de=m(null),N=m(null),X=m(null),O=m("source");function Qe(e){ie.value=F.getItem(`${e}ChUnread`),se.value=F.getItem(`${e}ChDownloaded`),de.value=F.getItem(`${e}ChBookmarked`),N.value=F.getItem(`${e}ChSource`),X.value=F.getItem(`${e}ChFetchDate`),O.value=F.getItem(`${e}ChDisplay`);const t=function(a){a==null?F.remove(`${e}ChUnread`):F.set(`${e}ChUnread`,a),ie.value=a},c=function(a){R(`${e}ChDownloaded`,a),se.value=a},d=function(a){R(`${e}ChBookmarked`,a),de.value=a},S=function(a){a!=null&&(R(`${e}ChSource`,a),F.remove(`${e}ChFetchDate`)),N.value=a},h=function(a){a!=null&&(R(`${e}ChFetchDate`,a),F.remove(`${e}ChSource`)),X.value=a},r=function(a){R(`${e}ChDisplay`,a,"source"),O.value=a};return N.value==null&&X.value==null&&(N.value=!1),O.value==null&&(O.value="source"),{Unread:ie,Downloaded:se,Bookmarked:de,Source:N,FetchDate:X,Display:O,setUnread:t,setDownloaded:c,setBookmarked:d,setSource:S,setFetchDate:h,setDisplay:r}}const Lt=Z({name:"LibraryTopBar",setup(){const e=Me(),t=Qe(parseInt(`${e.params.mangaID}`)),c=m(t);return{dialo:m(!1),tab:m("filter"),unread:m(t.Unread),downloaded:m(t.Downloaded),bookmarked:m(t.Bookmarked),Source:m(t.Source),FetchDate:m(t.FetchDate),filt:c,disp:m(t.Display)}},watch:{unread(){this.filt.setUnread(this.unread)},downloaded(){this.filt.setDownloaded(this.downloaded)},bookmarked(){this.filt.setBookmarked(this.bookmarked)},Source(){this.filt.setSource(this.Source),this.Source!=null&&(this.FetchDate=null)},FetchDate(){this.filt.setFetchDate(this.FetchDate),this.FetchDate!=null&&(this.Source=null)},disp(){this.filt.setDisplay(this.disp)}},methods:{aredefaults(){return this.unread==null&&this.downloaded==null&&this.bookmarked==null&&this.Source==!1&&this.FetchDate==null&&this.disp=="source"}}}),Rt={key:0},Ht={key:1},Nt={key:2};function Ot(e,t,c,d,S,h){return u(),z(ce,null,[o(V,{flat:"",class:"q-ml-sm",round:"","text-color":e.$q.dark.isActive?e.aredefaults()?"white":"orange":e.aredefaults()?"dark":"orange",icon:"filter_list",onClick:t[0]||(t[0]=r=>e.dialo=!0)},null,8,["text-color"]),o(bt,{modelValue:e.dialo,"onUpdate:modelValue":t[9]||(t[9]=r=>e.dialo=r)},{default:l(()=>[o(vt,null,{default:l(()=>[o(P,{class:"q-pa-none"},{default:l(()=>[o(pt,{modelValue:e.tab,"onUpdate:modelValue":t[1]||(t[1]=r=>e.tab=r),class:"text-teal"},{default:l(()=>[o(re,{class:"q-px-xl",name:"filter",icon:"filter_list",label:"Filter"}),o(re,{class:"q-px-xl",name:"sort",icon:"sort",label:"Sort"}),o(re,{class:"q-px-xl",name:"display",icon:"display_settings",label:"Display"})]),_:1},8,["modelValue"])]),_:1}),e.tab=="filter"?(u(),z("div",Rt,[o(P,{class:"q-px-md q-pt-md q-pb-xs"},{default:l(()=>[o(H,{modelValue:e.unread,"onUpdate:modelValue":t[2]||(t[2]=r=>e.unread=r),style:{width:"100%"},"toggle-indeterminate":"",label:"Unread","checked-icon":"check_box","unchecked-icon":"r_disabled_by_default","indeterminate-icon":"check_box_outline_blank","keep-color":"",size:"lg",color:"primary"},null,8,["modelValue"])]),_:1}),o(P,{class:"q-px-md q-py-xs"},{default:l(()=>[o(H,{modelValue:e.downloaded,"onUpdate:modelValue":t[3]||(t[3]=r=>e.downloaded=r),style:{width:"100%"},"toggle-indeterminate":"",label:"Downloaded","checked-icon":"check_box","unchecked-icon":"r_disabled_by_default","indeterminate-icon":"check_box_outline_blank","keep-color":"",size:"lg",color:"primary"},null,8,["modelValue"])]),_:1}),o(P,{class:"q-px-md q-pt-xs q-pb-md"},{default:l(()=>[o(H,{modelValue:e.bookmarked,"onUpdate:modelValue":t[4]||(t[4]=r=>e.bookmarked=r),style:{width:"100%"},"toggle-indeterminate":"",label:"Bookmarked","checked-icon":"check_box","unchecked-icon":"r_disabled_by_default","indeterminate-icon":"check_box_outline_blank","keep-color":"",size:"lg",color:"primary"},null,8,["modelValue"])]),_:1})])):$("",!0),e.tab=="sort"?(u(),z("div",Ht,[o(P,{class:"q-px-md q-pt-md q-pb-xs"},{default:l(()=>[o(H,{modelValue:e.Source,"onUpdate:modelValue":t[5]||(t[5]=r=>e.Source=r),style:{width:"100%"},"checked-icon":"arrow_upward","unchecked-icon":"arrow_downward","indeterminate-icon":"null",color:"primary","keep-color":"",label:"By Source"},null,8,["modelValue"])]),_:1}),o(P,{class:"q-px-md q-pt-xs q-pb-md"},{default:l(()=>[o(H,{modelValue:e.FetchDate,"onUpdate:modelValue":t[6]||(t[6]=r=>e.FetchDate=r),style:{width:"100%"},"checked-icon":"arrow_upward","unchecked-icon":"arrow_downward","indeterminate-icon":"null",color:"primary","keep-color":"",label:"By Fetch date"},null,8,["modelValue"])]),_:1})])):$("",!0),e.tab=="display"?(u(),z("div",Nt,[o(P,{class:"q-px-md q-pt-md q-pb-xs"},{default:l(()=>[o(we,{modelValue:e.disp,"onUpdate:modelValue":t[7]||(t[7]=r=>e.disp=r),val:"source",label:"By Source Title"},null,8,["modelValue"])]),_:1}),o(P,{class:"q-px-md q-pt-xs q-pb-md"},{default:l(()=>[o(we,{modelValue:e.disp,"onUpdate:modelValue":t[8]||(t[8]=r=>e.disp=r),val:"chapter",label:"By Chapter Number"},null,8,["modelValue"])]),_:1})])):$("",!0)]),_:1})]),_:1},8,["modelValue"])],64)}var jt=x(Lt,[["render",Ot]]);const Et=Z({name:"MangaChapters",components:{filterr:jt},setup(){const e=Me(),t=m(Qe(parseInt(`${e.params.mangaID}`))),c=m([]),d=m([]),S=gt(),h=m(S),r=m([]),a=m(0),n=S.eventsFromServer.value?JSON.parse(S.eventsFromServer.value):[];if(Se(n)){const Q=n.queue.filter(_=>_.mangaId==parseInt(`${e.params.mangaID}`));a.value=Q.length,r.value=Q}h.value.isConnected&&S.sendMsg("STATUS");const i=m([18,18]),I=m(!1);return{chapters:c,chaptersfilt:d,filters:t,Emitter:h,downloadsnum:a,downloads:r,selectMode:m(!1),selected:m([]),fabPos:i,draggingFab:I}},computed:{doFilt(){let e=this.chapters;return this.filters.Unread!=null&&(e=e.filter(t=>this.filters.Unread?!t.read:t.read)),this.filters.Downloaded!=null&&(e=e.filter(t=>this.filters.Downloaded?t.downloaded:!t.downloaded)),this.filters.Bookmarked!=null&&(e=e.filter(t=>this.filters.Bookmarked?t.bookmarked:!t.bookmarked)),e},doSrt(){let e=this.doFilt;return this.filters.Source!=null&&(e=e.sort((t,c)=>this.filters.Source?t.index>c.index?1:-1:t.index<c.index?1:-1)),this.filters.FetchDate!=null&&(e=e.sort((t,c)=>this.filters.FetchDate?t.fetchedAt>c.fetchedAt?-1:1:t.fetchedAt<c.fetchedAt?-1:1)),e},res(){const e=this.doSrt.filter(t=>!t.read);if(e.length){const t=e[e.length-1];return`/manga/${t.mangaId}/chapter/${t.index}`}else return`/manga/${this.$route.params.mangaID}/chapter/${1}`}},watch:{"Emitter.eventsFromServer"(e){const t=JSON.parse(e);if(Se(t)){const c=t.queue.filter(d=>d.mangaId==parseInt(`${this.$route.params.mangaID}`));this.downloadsnum!=c.length&&this.getonline(),this.downloadsnum=c.length,this.downloads=c}}},created:async function(){this.$bus.on("updateManga",()=>{this.getonline("true")}),this.getonline()},methods:{moveFab(e){this.draggingFab=e.isFirst!==!0&&e.isFinal!==!0;let t=this.fabPos[0]-e.delta.x,c=this.fabPos[1]-e.delta.y;const d=this.$refs.conta.parentElement.getBoundingClientRect(),S=this.$refs.sticky.$el.getBoundingClientRect(),h=d.height,r=S.height;c>h-r&&(c=h-r),c<0&&(c=0);const a=d.width,n=S.width;t>a-n&&(t=a-n),t<0&&(t=0),this.fabPos=[t,c]},calcHeight(){const e=this.$refs.chapHead;if(e==null)return 0;let t=e.getBoundingClientRect().bottom;return t+=parseInt(window.getComputedStyle(e).getPropertyValue("margin-bottom")),t||0},async getonline(e="false",t=2){try{this.chapters=(await this.$api.get(`/api/v1/manga/${this.$route.params.mangaID}/chapters?onlineFetch=${e}`)).data}catch{t--,t>=0?(console.warn("fetch chapters failed in chapterList Retrying, retries left: "+t),this.getonline(e,t)):console.error("fetch chapters failed in chapterList")}},async download(e){await this.$api.get(`/api/v1/download/${this.$route.params.mangaID}/chapter/${e}`)},async dele(e){await this.$api.delete(`/api/v1/manga/${this.$route.params.mangaID}/chapter/${e}`),this.getonline()},async mpatch(e,t){await this.$api.patchForm(`/api/v1/manga/${this.$route.params.mangaID}/chapter/${e}`,t),this.getonline()},handleHold(e){this.selectMode=!0,this.selectthis(e)},selectthis(e){this.selected.includes(e)?this.selected=this.selected.filter(t=>t!==e):this.selected.push(e)},selectall(){this.selected.length?this.selected=[]:this.selected=this.doSrt.map(e=>e.id)},dl(e){this.$api.post("/api/v1/download/batch",{chapterIds:e})},read(e,t=!0,c="isRead"){this.$api.post(`/api/v1/manga/${this.$route.params.mangaID}/chapter/batch`,{chapterIds:e,change:{[c]:t}}).then(()=>this.getonline())}}}),Jt={ref:"conta"},Gt={ref:"chapHead",class:"row justify-between items-center"},Kt={class:"q-ma-md"},Xt={style:{"padding-right":"12px"}};function Yt(e,t,c,d,S,h){const r=W("filterr"),a=W("router-link");return u(),z("div",Jt,[M("div",Gt,[M("h4",Kt,q(e.chapters.length)+" chapters",1),M("div",Xt,[e.selectMode?(u(),b(V,{key:0,flat:"",round:"",icon:"select_all",onClick:e.selectall},null,8,["onClick"])):$("",!0),o(V,{flat:"",round:"",icon:e.selectMode?"flip_to_front":"flip_to_back",onClick:t[0]||(t[0]=n=>e.selectMode=!e.selectMode)},null,8,["icon"]),o(V,{round:"",flat:"",icon:"more_vert"},{default:l(()=>[o(A,{anchor:"bottom end",self:"top right"},{default:l(()=>[o(L,{style:{width:"fit-content"}},{default:l(()=>[o(g,{clickable:""},{default:l(()=>[o(v,{side:""},{default:l(()=>[o(T,{name:"keyboard_arrow_left"})]),_:1}),o(v,null,{default:l(()=>[p("download")]),_:1}),o(A,{anchor:"top start",self:"top end",style:{"white-space":"nowrap"}},{default:l(()=>[o(L,null,{default:l(()=>[y((u(),b(g,{clickable:"",onClick:t[1]||(t[1]=n=>e.dl(e.doSrt.filter(i=>!i.downloaded).map(i=>i.id)))},{default:l(()=>[o(v,null,{default:l(()=>[p("Download All")]),_:1})]),_:1})),[[w]]),y((u(),b(g,{clickable:"",onClick:t[2]||(t[2]=n=>e.dl(e.doSrt.filter(i=>!i.downloaded).slice(-5).map(i=>i.id)))},{default:l(()=>[o(v,null,{default:l(()=>[p("Download Next 5")]),_:1})]),_:1})),[[w]]),e.selectMode?y((u(),b(g,{key:0,clickable:"",onClick:t[3]||(t[3]=n=>e.dl(e.selected))},{default:l(()=>[o(v,null,{default:l(()=>[p("Download Selected")]),_:1})]),_:1})),[[w]]):$("",!0)]),_:1})]),_:1})]),_:1}),o(g,{clickable:""},{default:l(()=>[o(v,{side:""},{default:l(()=>[o(T,{name:"keyboard_arrow_left"})]),_:1}),o(v,null,{default:l(()=>[p("Read")]),_:1}),o(A,{anchor:"top start",self:"top end",style:{"white-space":"nowrap"}},{default:l(()=>[o(L,null,{default:l(()=>[y((u(),b(g,{clickable:"",onClick:t[4]||(t[4]=n=>e.read(e.doSrt.filter(i=>!i.read).map(i=>i.id)))},{default:l(()=>[o(v,null,{default:l(()=>[p("Read All")]),_:1})]),_:1})),[[w]]),y((u(),b(g,{clickable:"",onClick:t[5]||(t[5]=n=>e.read(e.doSrt.filter(i=>!i.read).slice(-5).map(i=>i.id)))},{default:l(()=>[o(v,null,{default:l(()=>[p("Read Next 5")]),_:1})]),_:1})),[[w]]),e.selectMode?y((u(),b(g,{key:0,clickable:"",onClick:t[6]||(t[6]=n=>e.read(e.selected))},{default:l(()=>[o(v,null,{default:l(()=>[p("Read Selected")]),_:1})]),_:1})),[[w]]):$("",!0)]),_:1})]),_:1})]),_:1}),o(g,{clickable:""},{default:l(()=>[o(v,{side:""},{default:l(()=>[o(T,{name:"keyboard_arrow_left"})]),_:1}),o(v,null,{default:l(()=>[p("Unread")]),_:1}),o(A,{anchor:"top start",self:"top end",style:{"white-space":"nowrap"}},{default:l(()=>[o(L,null,{default:l(()=>[y((u(),b(g,{clickable:"",onClick:t[7]||(t[7]=n=>e.read(e.doSrt.filter(i=>!!i.read).map(i=>i.id),!1))},{default:l(()=>[o(v,null,{default:l(()=>[p("Unread All")]),_:1})]),_:1})),[[w]]),y((u(),b(g,{clickable:"",onClick:t[8]||(t[8]=n=>e.read(e.doSrt.filter(i=>!!i.read).slice(0,5).map(i=>i.id),!1))},{default:l(()=>[o(v,null,{default:l(()=>[p("Unread Last 5")]),_:1})]),_:1})),[[w]]),e.selectMode?y((u(),b(g,{key:0,clickable:"",onClick:t[9]||(t[9]=n=>e.read(e.selected,!1))},{default:l(()=>[o(v,null,{default:l(()=>[p("Unread Selected")]),_:1})]),_:1})),[[w]]):$("",!0)]),_:1})]),_:1})]),_:1}),o(g,{clickable:""},{default:l(()=>[o(v,{side:""},{default:l(()=>[o(T,{name:"keyboard_arrow_left"})]),_:1}),o(v,null,{default:l(()=>[p("Bookmark")]),_:1}),o(A,{anchor:"top start",self:"top end",style:{"white-space":"nowrap"}},{default:l(()=>[o(L,null,{default:l(()=>[y((u(),b(g,{clickable:"",onClick:t[10]||(t[10]=n=>e.read(e.doSrt.filter(i=>!i.bookmarked).map(i=>i.id),!0,"isBookmarked"))},{default:l(()=>[o(v,null,{default:l(()=>[p("Bookmark All")]),_:1})]),_:1})),[[w]]),y((u(),b(g,{clickable:"",onClick:t[11]||(t[11]=n=>e.read(e.doSrt.filter(i=>!i.bookmarked).slice(-5).map(i=>i.id),!0,"isBookmarked"))},{default:l(()=>[o(v,null,{default:l(()=>[p("Bookmark Next 5")]),_:1})]),_:1})),[[w]]),e.selectMode?y((u(),b(g,{key:0,clickable:"",onClick:t[12]||(t[12]=n=>e.read(e.selected,!0,"isBookmarked"))},{default:l(()=>[o(v,null,{default:l(()=>[p("Bookmark Selected")]),_:1})]),_:1})),[[w]]):$("",!0)]),_:1})]),_:1})]),_:1}),o(g,{clickable:""},{default:l(()=>[o(v,{side:""},{default:l(()=>[o(T,{name:"keyboard_arrow_left"})]),_:1}),o(v,null,{default:l(()=>[p("Unbookmark")]),_:1}),o(A,{anchor:"top start",self:"top end",style:{"white-space":"nowrap"}},{default:l(()=>[o(L,null,{default:l(()=>[y((u(),b(g,{clickable:"",onClick:t[13]||(t[13]=n=>e.read(e.doSrt.filter(i=>!!i.bookmarked).map(i=>i.id),!1,"isBookmarked"))},{default:l(()=>[o(v,null,{default:l(()=>[p("Unbookmark All")]),_:1})]),_:1})),[[w]]),y((u(),b(g,{clickable:"",onClick:t[14]||(t[14]=n=>e.read(e.doSrt.filter(i=>!!i.bookmarked).slice(0,5).map(i=>i.id),!1,"isBookmarked"))},{default:l(()=>[o(v,null,{default:l(()=>[p("Unbookmark Last 5")]),_:1})]),_:1})),[[w]]),e.selectMode?y((u(),b(g,{key:0,clickable:"",onClick:t[15]||(t[15]=n=>e.read(e.selected,!1,"isBookmarked"))},{default:l(()=>[o(v,null,{default:l(()=>[p("Unbookmark Selected")]),_:1})]),_:1})),[[w]]):$("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),o(r)])],512),o(At,{class:Y(["q-pr-xs",e.selectMode?" selectmode":""]),style:De(e.$q.screen.sm||e.$q.screen.xs?"height: 50vh":"height: calc(100vh - "+e.calcHeight()+"px)")},{default:l(()=>[(u(!0),z(ce,null,qe(e.doSrt,n=>(u(),b(rt,{key:n.index,style:{height:"58px"},class:""},{default:l(()=>[y((u(),b(g,{id:n.id,key:n.index,clickable:"",class:Y(["q-ma-sm rounded-borders",(n.read?"text-grey":"")+" "+(e.selected.includes(n.id)&&e.selectMode?"selected":"")+" "+(e.$q.dark.isActive?"bg-dark":"bg-light")]),to:e.selectMode?void 0:"/manga/"+n.mangaId+"/chapter/"+n.index,onClick:i=>e.selectMode?e.selectthis(n.id):void 0},{default:l(()=>[n.bookmarked?(u(),b(v,{key:0,side:""},{default:l(()=>[o(ae,null,{default:l(()=>[o(T,{color:"primary",name:"bookmark",size:"sm"})]),_:1})]),_:1})):$("",!0),o(v,null,{default:l(()=>[o(ae,null,{default:l(()=>[p(q(e.filters.Display=="source"?n.name:"Chapter "+n.chapterNumber),1)]),_:2},1024),o(ae,{caption:""},{default:l(()=>{var i,I,Q,_;return[p(q(n.scanlator)+" "+q(new Date(n.uploadDate).toLocaleDateString())+" "+q(n.downloaded?"\u2022 downloaded":"")+" "+q((i=e.downloads.find(D=>D.chapterIndex==n.index))!=null&&i.state?"\u2022 "+((I=e.downloads.find(D=>D.chapterIndex==n.index))==null?void 0:I.state):"")+" ",1),((Q=e.downloads.find(D=>D.chapterIndex==n.index))==null?void 0:Q.state)=="Downloading"?(u(),b(ot,{key:0,value:(_=e.downloads.find(D=>D.chapterIndex==n.index))==null?void 0:_.progress},null,8,["value"])):$("",!0)]}),_:2},1024)]),_:2},1024),e.selectMode?(u(),b(T,{key:1,class:"flex-right self-center",size:"md",color:e.selected.includes(n.id)?"blue":"",name:e.selected.includes(n.id)?"check_box":"check_box_outline_blank",flat:""},null,8,["color","name"])):$("",!0),o(V,{round:"",flat:"",icon:"more_vert",class:"flex-right",onClick:t[16]||(t[16]=lt(()=>{},["prevent"]))},{default:l(()=>[o(A,null,{default:l(()=>[o(L,{style:{width:"fit-content"}},{default:l(()=>[n.downloaded?$("",!0):y((u(),b(g,{key:0,clickable:"",onClick:i=>e.download(n.index)},{default:l(()=>[o(v,null,{default:l(()=>[p("Download")]),_:1})]),_:2},1032,["onClick"])),[[w]]),n.downloaded?y((u(),b(g,{key:1,clickable:"",onClick:i=>e.dele(n.index)},{default:l(()=>[o(v,null,{default:l(()=>[p("Delete")]),_:1})]),_:2},1032,["onClick"])),[[w]]):$("",!0),y((u(),b(g,{clickable:"",onClick:i=>e.mpatch(n.index,{bookmarked:`${!n.bookmarked}`})},{default:l(()=>[o(v,null,{default:l(()=>[p(q(n.bookmarked?"Remove bookmark":"Bookmark"),1)]),_:2},1024)]),_:2},1032,["onClick"])),[[w]]),y((u(),b(g,{clickable:"",onClick:i=>e.mpatch(n.index,{read:`${!n.read}`,lastPageRead:"1"})},{default:l(()=>[o(v,null,{default:l(()=>[p(q(n.read?"Mark as Unread":"Mark as Read"),1)]),_:2},1024)]),_:2},1032,["onClick"])),[[w]]),y((u(),b(g,{clickable:"",onClick:i=>e.mpatch(n.index,{markPrevRead:"true"})},{default:l(()=>[o(v,{style:{"white-space":"nowrap"}},{default:l(()=>[p("Mark previous as Read")]),_:1})]),_:2},1032,["onClick"])),[[w]])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["id","class","to","onClick"])),[[Tt,()=>e.handleHold(n.id),void 0,{mouse:!0}],[ht]])]),_:2},1024))),128))]),_:1},8,["style","class"]),o(ft,{ref:"sticky",position:"bottom-right",offset:e.fabPos},{default:l(()=>[o(a,{is:e.draggingFab?"span":"router-link",style:{"text-decoration":"none",color:"inherit"},to:e.res},{default:l(()=>[y((u(),b(V,{fab:"",class:"Fabconsist",label:"Resume",color:"blue",icon:"drag_indicator"},{default:l(()=>[o(mt,null,{default:l(()=>[p(" draggable ")]),_:1})]),_:1})),[[ue,e.moveFab,void 0,{prevent:!0,mouse:!0}]])]),_:1},8,["is","to"])]),_:1},8,["offset"])],512)}var Wt=x(Et,[["render",Yt],["__scopeId","data-v-85dacada"]]);const Zt=Z({name:"MangaPage",components:{mangaInfo:Ut,mangaChapters:Wt},emits:["set-title"],setup(){return{manga:m({}),offset:m(Number())}},created:async function(){var e;this.$bus.on("updateManga",()=>{this.getonline("true")}),await this.getonline(),this.$emit("set-title",((e=this.manga)==null?void 0:e.title)||"manga"),new Date(this.manga.lastFetchedAt*1e3)<new Date(new Date().setDate(new Date().getDate()-1))&&this.$bus.emit("updateManga")},methods:{async getonline(e="false",t=3){try{this.manga=(await this.$api.get(`/api/v1/manga/${this.$route.params.mangaID}/?onlineFetch=${e}`)).data}catch{t>=1&&await this.getonline(e,t-1)}},myTweak(e){return this.offset=e,{height:e?`calc(100vh - ${e}px)`:"100vh"}}}});function xt(e,t,c,d,S,h){const r=W("mangaInfo"),a=W("mangaChapters");return u(),b(je,{class:Y(["nowrap",e.$q.screen.sm||e.$q.screen.xs?"col":"row"]),"style-fn":e.myTweak},{default:l(()=>[o(r,{manga:e.manga,offset:e.offset,class:"col-6",onInlib:e.getonline},null,8,["manga","offset","onInlib"]),o(a,{class:"col-6"})]),_:1},8,["class","style-fn"])}var Ea=x(Zt,[["render",xt]]);export{Ea as default};
