import{Q as B,a as _}from"./QItemLabel.7817de0d.js";import{Q as P}from"./QItem.1b5b75f5.js";import{Q as R}from"./QCardSection.e0e93f50.js";import{u as F,a as V,Q as G}from"./QBtn.2618318f.js";import{Q as W}from"./QCardActions.53a204ef.js";import{Q as T}from"./QCard.7d319dde.js";import{Q as j}from"./QDialog.f412eed5.js";import{Q as z}from"./QPage.08615c70.js";import{C as S}from"./ClosePopup.1115a53f.js";import{u as A,a as H,b as N,Q as U}from"./QTabs.e7ca3230.js";import{c as E}from"./QSpinner.b7263a4e.js";import{c as O,w as J,d as C,r as u,_ as k,a9 as K,aa as X,f as r,v as h,u as m,m as i,k as s,F as q,x as I,q as f,j as l,s as v,y as M,ab as p,p as b,t as c,n as d,ac as Y}from"./index.1d2a11c1.js";import{Q as Z}from"./QIntersection.b5f69b4f.js";import{Q}from"./QInnerLoading.b338ea2e.js";import{Q as $}from"./QBadge.3ea654a3.js";import{g as x,Q as D}from"./usefull.2cec48aa.js";import{R as tt}from"./Ripple.a336c28f.js";import{storeGet as et}from"./StoreStuff.ce90795c.js";import{u as at}from"./Filters.0b615c43.js";import"./use-dark.ab9cbb55.js";import"./QIcon.1944e62f.js";import"./use-transition.9805678b.js";import"./focus-manager.32f8d49a.js";import"./scroll.c375e4e4.js";import"./dom.a06f9928.js";import"./uid.42677368.js";import"./QResizeObserver.3ae1b354.js";import"./rtl.b51694b1.js";import"./Intersection.f91b3b0a.js";import"./axios.4d2f3287.js";import"./getenv.7492fdf7.js";var st=E({name:"QRouteTab",props:{...F,...A},emits:H,setup(t,{slots:e,emit:a}){const n=V({useDisableForRouterLinkProps:!1}),{renderTab:g,$tabs:y}=N(t,e,a,{exact:O(()=>t.exact),...n});return J(()=>`${t.name} | ${t.exact} | ${(n.resolvedLink.value||{}).href}`,()=>{y.verifyRouteModel()}),()=>g(n.linkTag.value,n.linkAttrs.value)}});const rt=C({name:"TabPanel",props:{tabs:{type:Array,default:()=>[]}},setup(){const t=K(),e=X();return e.query.tab===void 0&&t.push({query:{...e.query,tab:0}}),{tab:u(new Number(e.query.tab).valueOf()||0)}}}),it={class:""},ot={class:"q-gutter-y-md"};function nt(t,e,a,n,g,y){return r(),h("div",it,[m("div",ot,[i(U,{modelValue:t.tab,"onUpdate:modelValue":e[0]||(e[0]=o=>t.tab=o),"inline-label":"",class:f(t.$q.dark.isActive?"bg-dark-page":"bg-light-page")},{default:s(()=>[(r(!0),h(q,null,I(t.tabs,o=>(r(),l(st,{key:o.tabID,name:o.tabID,label:o.tabname,class:f(["col-grow",t.$route.query.tab==o.tabID.toString()?"text-primary":""]),flat:"",to:{query:{...t.$route.query,tab:o.tabID}}},null,8,["name","label","to","class"]))),128))]),_:1},8,["modelValue","class"])])])}var lt=k(rt,[["render",nt]]);const dt=C({name:"MangaCard",props:{manga:{type:Object,default:()=>Object},display:{type:String,default:"compact"},ubadge:{type:Boolean,default:!0},dbadge:{type:Boolean,default:!0}},setup(){const t=u(`${et("useCache",!0)}`),e=u("");return{useCache:t,imgdata:e}},computed:{listdivClass(){return this.display=="list"?"text-left q-ml-md text-h5 col-shrink":"text-center text-subtitle1"}},mounted:function(){x(this.manga.thumbnailUrl+"?useCache="+this.useCache).then(t=>{this.imgdata=t})}}),ut={class:"transparent absolute-top q-mt-xs q-ml-xs",style:{padding:"0"}},mt=["title"],pt={class:"row items-center col-grow no-wrap"},ct=["title"];function ft(t,e,a,n,g,y){const o=v("router-link");return M((r(),l(T,{flat:"",class:f(["my-card",t.$q.screen.sm||t.$q.screen.xs?"q-ma-xs":"q-ma-sm"]),style:p(t.display=="list"?"":"background: transparent")},{default:s(()=>[i(o,{to:"/manga/"+t.manga.id,class:f(["cursor-pointer",t.$q.dark.isActive?"light":"dark"]),style:{"text-decoration":"none"}},{default:s(()=>[t.display!="list"?(r(),l(D,{key:0,src:t.imgdata,loading:"lazy","spinner-color":"white",style:{"max-width":"100%","aspect-ratio":"225/350"},class:"rounded-borders","no-spinner":""},{default:s(()=>[i(Q,{showing:!t.imgdata,color:"primary"},null,8,["showing"]),m("div",ut,[t.manga.unreadCount&&t.ubadge?(r(),l($,{key:0,color:"blue",style:p([{width:"min-content",padding:"5px"},t.manga.downloadCount?"border-top-right-radius: 0;border-bottom-right-radius: 0;":""])},{default:s(()=>[b(c(t.manga.unreadCount),1)]),_:1},8,["style"])):d("",!0),t.manga.downloadCount&&t.dbadge?(r(),l($,{key:1,color:"green",style:p([{width:"min-content",padding:"5px"},t.manga.unreadCount?"border-top-left-radius: 0;border-bottom-left-radius: 0;":""])},{default:s(()=>[b(c(t.manga.downloadCount),1)]),_:1},8,["style"])):d("",!0)]),t.display=="compact"?(r(),h("div",{key:0,class:"absolute-bottom text-subtitle1 text-center",title:t.manga.title,style:{padding:"0",display:"-webkit-box","-webkit-line-clamp":"2","-webkit-box-orient":"vertical","text-overflow":"ellipsis",height:"3.5rem"}},c(t.manga.title),9,mt)):d("",!0)]),_:1},8,["src"])):d("",!0),m("div",pt,[t.display=="list"?(r(),l(D,{key:0,src:t.imgdata,loading:"lazy","spinner-color":"white",style:{height:"93px","aspect-ratio":"225/350",width:"fit-content"},class:"rounded-borders items-center justify-center col-1","no-spinner":""},{default:s(()=>[i(Q,{showing:!t.imgdata,color:"primary"},null,8,["showing"])]),_:1},8,["src"])):d("",!0),t.display!="compact"?(r(),h("div",{key:1,class:f(t.listdivClass),title:t.manga.title,style:p([{padding:"0",display:"-webkit-box","-webkit-line-clamp":"3","-webkit-box-orient":"vertical","text-overflow":"ellipsis",overflow:"hidden",width:"100%"},t.display=="list"?"":"height: 5.25rem;"])},c(t.manga.title),15,ct)):d("",!0),m("div",{class:f(["justify-end flex items-end col-grow",t.$q.screen.sm||t.$q.screen.xs?"q-mr-xs":"q-mr-lg"])},[t.manga.unreadCount&&t.display=="list"&&t.ubadge?(r(),l($,{key:0,color:"blue",style:p([{width:"min-content",padding:"5px"},t.manga.downloadCount?"border-top-right-radius: 0;border-bottom-right-radius: 0;":""])},{default:s(()=>[b(c(t.manga.unreadCount),1)]),_:1},8,["style"])):d("",!0),t.manga.downloadCount&&t.display=="list"&&t.dbadge?(r(),l($,{key:1,color:"green",style:p([{width:"min-content",padding:"5px"},t.manga.unreadCount?"border-top-left-radius: 0;border-bottom-left-radius: 0;":""])},{default:s(()=>[b(c(t.manga.downloadCount),1)]),_:1},8,["style"])):d("",!0)],2)])]),_:1},8,["to","class"])]),_:1},8,["class","style"])),[[tt]])}var ht=k(dt,[["render",ft],["__scopeId","data-v-63b6eec6"]]);const gt=C({name:"MangaGrid",components:{MangaCard:ht},setup(){const t=u(at()),e=u(0),a=u(0),n=u([]);return{devider:e,mangas:n,filters:t,clwidth:a}},computed:{doFilt(){let t=this.mangas;return this.$route.query.q&&(t=t.filter(e=>e.title.toLowerCase().includes(`${this.$route.query.q||""}`.toLowerCase()))),this.filters.unread!=null&&(t=t.filter(e=>this.filters.unread?!!e.unreadCount:!e.unreadCount)),this.filters.downloaded!=null&&(t=t.filter(e=>this.filters.downloaded?!!e.downloadCount:!e.downloadCount)),t},dosrt(){let t=this.doFilt;return this.filters.leftToRead!=null&&(t=t.sort((e,a)=>this.filters.leftToRead?e.unreadCount>=a.unreadCount?-1:1:e.unreadCount<=a.unreadCount?-1:1)),this.filters.alphabetical!=null&&(t=t.sort((e,a)=>this.filters.alphabetical?e.title>=a.title?-1:1:e.title<=a.title?-1:1)),this.filters.ByID!=null&&(t=t.sort((e,a)=>this.filters.ByID?e.id>=a.id?-1:1:e.id<=a.id?-1:1)),t},Displ(){return this.filters.Display==null?"compact":this.filters.Display?"comfort":"list"},widt(){return this.Displ=="list"?"width:100%; height: 109px;":`width: calc(100% / ${this.devider}); aspect-ratio: 225/350;transition: width 0.5s ease-out;`}},watch:{"$route.query.tab":async function(t){this.reload(t)}},created:async function(){this.calcWidth=Y(this.calcWidth,500),this.reload(this.$route.query.tab)},mounted:function(){this.calcWidth(),this.$nextTick(()=>{window.addEventListener("resize",this.calcWidth)})},beforeUnmount(){window.removeEventListener("resize",this.calcWidth)},methods:{calcWidth(){const t=this.$refs.MangaGrid,e=this.$storeGet("MitemW",300);t.clientWidth!=null&&(this.devider=Math.round(t.clientWidth/e))},calcHeight(){var e;const t=(e=this.$parent)==null?void 0:e.$el;if(t){let a=t.clientHeight;return a-=t.children[0].clientHeight,a}return 0},async reload(t){t!=null&&(this.mangas=[],this.mangas=(await this.$api.get(`/api/v1/category/${this.$route.query.tab}`)).data)}}}),yt={ref:"MangaGrid",class:"flex"};function bt(t,e,a,n,g,y){const o=v("MangaCard");return r(),h(q,null,[m("div",yt,[(r(!0),h(q,null,I(t.dosrt,w=>(r(),l(Z,{key:w.id,style:p(t.widt),transition:"fade"},{default:s(()=>[i(o,{display:t.Displ,ubadge:t.filters.Ubadge,dbadge:t.filters.Dbadge,manga:w},null,8,["display","ubadge","dbadge","manga"])]),_:2},1032,["style"]))),128))],512),i(Q,{style:{position:"fixed",left:"50%",top:"50%",transform:"translate(-50%, -50%)",width:"fit-content",height:"fit-content","background-color":"transparent"},showing:!t.dosrt.length,color:"primary"},null,8,["showing"])],64)}var wt=k(gt,[["render",bt]]);const $t=C({name:"LibraryPage",components:{TabPanel:lt,MangaGrid:wt},emits:["set-title"],setup(t,{emit:e}){e("set-title","Library");const a=u([]),n=u(!1);return{tabs:a,failedFetch:n}},created:async function(){try{const t=await this.$api.get("/api/v1/category");this.tabs=t.data.map(e=>({tabname:e.name,tabID:e.id}))}catch{this.failedFetch=!0}},methods:{myTweak(t){return{height:t?`calc(100vh - ${t}px)`:"100vh"}}}}),vt=m("div",null,"Have you set your server address?",-1),Ct=m("div",null,"Is the server running?",-1),kt=m("div",{class:"q-pt-sm"}," Pressing Ok will take you to the settings page ",-1);function qt(t,e,a,n,g,y){const o=v("TabPanel"),w=v("MangaGrid");return r(),l(z,{"style-fn":t.myTweak},{default:s(()=>[i(o,{active:"",tabs:t.tabs},null,8,["tabs"]),t.failedFetch?d("",!0):(r(),l(w,{key:0})),i(j,{modelValue:t.failedFetch,"onUpdate:modelValue":e[0]||(e[0]=L=>t.failedFetch=L),persistent:""},{default:s(()=>[i(T,{style:{"min-width":"350px"}},{default:s(()=>[i(R,null,{default:s(()=>[i(P,null,{default:s(()=>[i(B,null,{default:s(()=>[i(_,{class:"text-h6 text-negative"},{default:s(()=>[b("Getting categories failed. ")]),_:1}),i(_,{class:"text-info q-pt-lg"},{default:s(()=>[vt,Ct,kt]),_:1})]),_:1})]),_:1})]),_:1}),i(W,{align:"right",class:"text-primary"},{default:s(()=>[M(i(G,{flat:"",label:"ok",to:"/settings"},null,512),[[S]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["style-fn"])}var ae=k($t,[["render",qt]]);export{ae as default};
